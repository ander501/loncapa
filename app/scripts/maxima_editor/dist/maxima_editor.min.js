(function(){function f(){this.operators=[]}f.ARG_SEPARATOR=";";f.DECIMAL_SIGN_1=".";f.DECIMAL_SIGN_2=",";f.prototype.operator=function(n,l,k,j,i,m){this.operators.push(new d(n,l,k,j,i,m))};f.prototype.separator=function(i){this.operator(i,d.BINARY,0,0,null,null)};f.prototype.infix=function(n,k,j,m){var l,i;l=d.BINARY;i=null;m=m||function(r,q){var o=[q,r.expression(j)];return new h(h.OPERATOR,this,n,o)};this.operator(n,l,k,j,i,m)};f.prototype.prefix=function(n,j,i){var l,k,m;l=d.UNARY;k=0;i=i||function(q){var o=[q.expression(j)];return new h(h.OPERATOR,this,n,o)};m=null;this.operator(n,l,k,j,i,m)};f.prototype.suffix=function(n,k,m){var l,j,i;l=d.UNARY;j=0;i=null;m=m||function(r,q){var o=[q];return new h(h.OPERATOR,this,n,o)};this.operator(n,l,k,j,i,m)};f.prototype.define=function(){this.suffix("!",160);this.infix("^",140,139);this.infix(".",130,129);this.infix("`",125,125);this.infix("*",120,120);this.infix("/",120,120);this.infix("+",100,100);this.operator("-",d.BINARY,100,134,function(j){var i=[j.expression(134)];return new h(h.OPERATOR,this,"-",i)},function(k,j){var i=[j,k.expression(100)];return new h(h.OPERATOR,this,"-",i)});this.infix("=",80,80);this.infix("#",80,80);this.infix("<=",80,80);this.infix(">=",80,80);this.infix("<",80,80);this.infix(">",80,80);this.separator(")");this.separator(f.ARG_SEPARATOR);this.operator("(",d.BINARY,200,200,function(j){var i=j.expression(0);j.advance(")");return i},function(k,j){if(j.type!=h.NAME&&j.type!=h.SUBSCRIPT){throw new a("Function name expected before a parenthesis.",k.tokens[k.token_nr-1].from)}var i=[j];if(k.current_token==null||k.current_token.op==null||k.current_token.op.id!==")"){while(true){i.push(k.expression(0));if(k.current_token==null||k.current_token.op==null||k.current_token.op.id!==f.ARG_SEPARATOR){break}k.advance(f.ARG_SEPARATOR)}}k.advance(")");return new h(h.FUNCTION,this,"(",i)});this.separator("]");this.operator("[",d.BINARY,200,70,function(j){var i=[];if(j.current_token==null||j.current_token.op==null||j.current_token.op.id!=="]"){while(true){i.push(j.expression(0));if(j.current_token==null||j.current_token.op==null||j.current_token.op.id!==f.ARG_SEPARATOR){break}j.advance(f.ARG_SEPARATOR)}}j.advance("]");return new h(h.VECTOR,this,null,i)},function(k,j){if(j.type!=h.NAME&&j.type!=h.SUBSCRIPT){throw new a("Name expected before a square bracket.",k.tokens[k.token_nr-1].from)}var i=[j];if(k.current_token==null||k.current_token.op==null||k.current_token.op.id!=="]"){while(true){i.push(k.expression(0));if(k.current_token==null||k.current_token.op==null||k.current_token.op.id!==f.ARG_SEPARATOR){break}k.advance(f.ARG_SEPARATOR)}}k.advance("]");return new h(h.SUBSCRIPT,this,"[",i)})};function h(j,l,k,i){this.type=j;this.op=l;this.value=k;this.children=i}h.UNKNOWN=0;h.NAME=1;h.NUMBER=2;h.OPERATOR=3;h.FUNCTION=4;h.VECTOR=5;h.SUBSCRIPT=6;h.prototype.toString=function(){var k="(";switch(this.type){case h.UNKNOWN:k+="UNKNOWN";break;case h.NAME:k+="NAME";break;case h.NUMBER:k+="NUMBER";break;case h.OPERATOR:k+="OPERATOR";break;case h.FUNCTION:k+="FUNCTION";break;case h.VECTOR:k+="VECTOR";break;case h.SUBSCRIPT:k+="SUBSCRIPT";break}if(this.op){k+=" '"+this.op.id+"'"}if(this.value){k+=" '"+this.value+"'"}if(this.children){k+=" [";for(var j=0;j<this.children.length;j++){k+=this.children[j].toString();if(j!=this.children.length-1){k+=","}}k+="]"}k+=")";return k};h.prototype.toMathML=function(){var F,E,B,A,z,I,G,l,w,x,H,o,u,y;if(this.children!=null&&this.children.length>0){F=this.children[0]}else{F=null}if(this.children!=null&&this.children.length>1){E=this.children[1]}else{E=null}if(this.children!=null&&this.children.length>2){B=this.children[2]}else{B=null}if(this.children!=null&&this.children.length>3){A=this.children[3]}else{A=null}if(this.children!=null&&this.children.length>4){z=this.children[4]}else{z=null}switch(this.type){case h.UNKNOWN:l=document.createElement("mtext");l.appendChild(document.createTextNode("???"));return(l);case h.NAME:if(this.value.search(/^[a-zA-Z]+[0-9]+$/)>=0){var t=this.value.search(/[0-9]/);y=document.createElement("msub");y.appendChild(this.mi(this.value.substring(0,t)));y.appendChild(this.mn(this.value.substring(t)));return(y)}else{return(this.mi(this.value))}case h.NUMBER:return(this.mn(this.value));case h.OPERATOR:if(this.value=="/"){u=document.createElement("mfrac");u.appendChild(F.toMathML());u.appendChild(E.toMathML());l=u}else{if(this.value=="^"){if(F.type==h.FUNCTION){if(F.value=="sqrt"||F.value=="abs"||F.value=="matrix"||F.value=="diff"){w=false}else{w=true}}else{if(F.type==h.OPERATOR){w=true}else{w=false}}l=document.createElement("msup");if(w){l.appendChild(this.addP(F))}else{l.appendChild(F.toMathML())}l.appendChild(E.toMathML())}else{if(this.value=="*"){x=document.createElement("mrow");if(F.type==h.OPERATOR&&(F.value=="+"||F.value=="-")){x.appendChild(this.addP(F))}else{x.appendChild(F.toMathML())}var J=E;while(J.type==h.OPERATOR){J=J.children[0]}if(J.type==h.NUMBER){x.appendChild(this.mo("\u22C5"))}if(E.type==h.OPERATOR&&(E.value=="+"||E.value=="-")){x.appendChild(this.addP(E))}else{x.appendChild(E.toMathML())}l=x}else{if(this.value=="-"){x=document.createElement("mrow");if(this.children.length==1){x.appendChild(this.mo("-"));x.appendChild(F.toMathML())}else{x.appendChild(F.toMathML());x.appendChild(this.mo("-"));if(E.type==h.OPERATOR&&(E.value=="+"||E.value=="-")){x.appendChild(this.addP(E))}else{x.appendChild(E.toMathML())}}l=x}else{if(this.value=="!"){x=document.createElement("mrow");H=this.mo(this.value);if(F.type==h.OPERATOR&&(F.value=="+"||F.value=="-")){x.appendChild(this.addP(F))}else{x.appendChild(F.toMathML())}x.appendChild(H);l=x}else{if(this.value=="+"){x=document.createElement("mrow");H=this.mo(this.value);x.appendChild(F.toMathML());x.appendChild(H);w=false;var r=E;while(r.type==h.OPERATOR){if(r.value=="-"&&r.children.length==1){w=true;break}else{if(r.value=="+"||r.value=="-"||r.value=="*"){r=r.children[0]}else{break}}}if(w){x.appendChild(this.addP(E))}else{x.appendChild(E.toMathML())}l=x}else{if(this.value=="."){x=document.createElement("mrow");if(F.type==h.OPERATOR&&(F.value=="+"||F.value=="-")){x.appendChild(this.addP(F))}else{x.appendChild(F.toMathML())}x.appendChild(this.mo("\u22C5"));if(E.type==h.OPERATOR&&(E.value=="+"||E.value=="-")){x.appendChild(this.addP(E))}else{x.appendChild(E.toMathML())}l=x}else{if(this.value=="`"){x=document.createElement("mrow");if(F.type==h.OPERATOR&&(F.value=="+"||F.value=="-")){x.appendChild(this.addP(F))}else{x.appendChild(F.toMathML())}var m=document.createElement("mstyle");m.setAttribute("fontstyle","normal");if(E.type==h.OPERATOR&&(E.value=="+"||E.value=="-")){m.appendChild(this.addP(E))}else{m.appendChild(E.toMathML())}x.appendChild(m);l=x}else{x=document.createElement("mrow");H=this.mo(this.value);x.appendChild(F.toMathML());x.appendChild(H);x.appendChild(E.toMathML());l=x}}}}}}}}return(l);case h.FUNCTION:if(F.value=="sqrt"&&E!=null){l=document.createElement("msqrt");l.appendChild(E.toMathML())}else{if(F.value=="abs"&&E!=null){x=document.createElement("mrow");x.appendChild(this.mo("|"));x.appendChild(E.toMathML());x.appendChild(this.mo("|"));l=x}else{if(F.value=="exp"&&E!=null){l=document.createElement("msup");l.appendChild(this.mi("e"));l.appendChild(E.toMathML())}else{if(F.value=="factorial"){x=document.createElement("mrow");H=this.mo("!");if(E.type==h.OPERATOR&&(E.value=="+"||E.value=="-")){x.appendChild(this.addP(E))}else{x.appendChild(E.toMathML())}x.appendChild(H);l=x}else{if(F.value=="diff"&&this.children!=null&&this.children.length==3){x=document.createElement("mrow");u=document.createElement("mfrac");u.appendChild(this.mi("d"));var D=document.createElement("mrow");D.appendChild(this.mi("d"));D.appendChild(this.mi(B.value));u.appendChild(D);x.appendChild(u);if(E.type==h.OPERATOR&&(E.value=="+"||E.value=="-")){x.appendChild(this.addP(E))}else{x.appendChild(E.toMathML())}l=x}else{if(F.value=="diff"&&this.children!=null&&this.children.length==4){x=document.createElement("mrow");u=document.createElement("mfrac");var q=document.createElement("msup");q.appendChild(this.mi("d"));q.appendChild(A.toMathML());u.appendChild(q);var D=document.createElement("mrow");D.appendChild(this.mi("d"));q=document.createElement("msup");q.appendChild(B.toMathML());q.appendChild(A.toMathML());D.appendChild(q);u.appendChild(D);x.appendChild(u);if(E.type==h.OPERATOR&&(E.value=="+"||E.value=="-")){x.appendChild(this.addP(E))}else{x.appendChild(E.toMathML())}l=x}else{if(F.value=="integrate"&&this.children!=null&&this.children.length==3){x=document.createElement("mrow");var H=this.mo("\u222B");H.setAttribute("stretchy","true");x.appendChild(H);if(B.type==h.OPERATOR&&(B.value=="+"||B.value=="-")){x.appendChild(this.addP(E))}else{x.appendChild(E.toMathML())}x.appendChild(this.mi("d"));x.appendChild(B.toMathML());l=x}else{if(F.value=="integrate"&&this.children!=null&&this.children.length==5){x=document.createElement("mrow");var v=document.createElement("msubsup");var H=this.mo("\u222B");H.setAttribute("stretchy","true");v.appendChild(H);v.appendChild(A.toMathML());v.appendChild(z.toMathML());x.appendChild(v);if(B.type==h.OPERATOR&&(B.value=="+"||B.value=="-")){x.appendChild(this.addP(E))}else{x.appendChild(E.toMathML())}x.appendChild(this.mi("d"));x.appendChild(B.toMathML());l=x}else{if(F.value=="sum"&&this.children!=null&&this.children.length==5){x=document.createElement("mrow");var p=document.createElement("munderover");var H=this.mo("\u2211");H.setAttribute("stretchy","true");p.appendChild(H);var k=document.createElement("mrow");k.appendChild(B.toMathML());k.appendChild(this.mo("="));k.appendChild(A.toMathML());p.appendChild(k);p.appendChild(z.toMathML());x.appendChild(p);if(B.type==h.OPERATOR&&(B.value=="+"||B.value=="-")){x.appendChild(this.addP(E))}else{x.appendChild(E.toMathML())}l=x}else{if(F.value=="product"&&this.children!=null&&this.children.length==5){x=document.createElement("mrow");var p=document.createElement("munderover");var H=this.mo("\u220F");H.setAttribute("stretchy","true");p.appendChild(H);var k=document.createElement("mrow");k.appendChild(B.toMathML());k.appendChild(this.mo("="));k.appendChild(A.toMathML());p.appendChild(k);p.appendChild(z.toMathML());x.appendChild(p);if(B.type==h.OPERATOR&&(B.value=="+"||B.value=="-")){x.appendChild(this.addP(E))}else{x.appendChild(E.toMathML())}l=x}else{if(F.value=="limit"){x=document.createElement("mrow");if(this.children.length<4){x.appendChild(this.mo("lim"))}else{var n=document.createElement("munder");n.appendChild(this.mo("lim"));var C=document.createElement("mrow");C.appendChild(B.toMathML());C.appendChild(this.mo("\u2192"));C.appendChild(A.toMathML());if(z!=null){if(z.value=="plus"){C.appendChild(this.mo("+"))}else{if(z.value=="minus"){C.appendChild(this.mo("-"))}}}n.appendChild(C);x.appendChild(n)}x.appendChild(E.toMathML());l=x}else{if(F.value=="binomial"){x=document.createElement("mrow");x.appendChild(this.mo("("));o=document.createElement("mtable");for(I=1;I<this.children.length;I++){var s=document.createElement("mtr");s.appendChild(this.children[I].toMathML());o.appendChild(s)}x.appendChild(o);x.appendChild(this.mo(")"));l=x}else{if(F.value=="matrix"){for(I=1;I<this.children.length;I++){if(this.children[I].type!==h.VECTOR){l=document.createElement("mtext");l.appendChild(document.createTextNode("???"));return(l)}}x=document.createElement("mrow");x.appendChild(this.mo("("));o=document.createElement("mtable");for(I=1;I<this.children.length;I++){var s=document.createElement("mtr");for(G=0;G<this.children[I].children.length;G++){s.appendChild(this.children[I].children[G].toMathML())}o.appendChild(s)}x.appendChild(o);x.appendChild(this.mo(")"));l=x}else{x=document.createElement("mrow");x.appendChild(F.toMathML());x.appendChild(this.mo("("));for(I=1;I<this.children.length;I++){x.appendChild(this.children[I].toMathML());if(I<this.children.length-1){x.appendChild(this.mo(f.ARG_SEPARATOR))}}x.appendChild(this.mo(")"));l=x}}}}}}}}}}}}}return(l);case h.VECTOR:x=document.createElement("mrow");x.appendChild(this.mo("("));o=document.createElement("mtable");for(I=0;I<this.children.length;I++){var s=document.createElement("mtr");s.appendChild(this.children[I].toMathML());o.appendChild(s)}x.appendChild(o);x.appendChild(this.mo(")"));return(x);case h.SUBSCRIPT:y=document.createElement("msub");y.appendChild(F.toMathML());if(this.children.length>2){x=document.createElement("mrow");for(I=1;I<this.children.length;I++){x.appendChild(this.children[I].toMathML());if(I<this.children.length-1){x.appendChild(this.mo(f.ARG_SEPARATOR))}}y.appendChild(x)}else{y.appendChild(E.toMathML())}return(y)}};h.prototype.mi=function(j){var i=document.createElement("mi");if(h.symbols[j]){j=h.symbols[j]}i.appendChild(document.createTextNode(j));return i};h.prototype.mn=function(j){var i=document.createElement("mn");i.appendChild(document.createTextNode(j));return i};h.prototype.mo=function(i){var j=document.createElement("mo");if(h.symbols[i]){i=h.symbols[i]}j.appendChild(document.createTextNode(i));return j};h.prototype.addP=function(j){var i=document.createElement("mrow");i.appendChild(this.mo("("));i.appendChild(j.toMathML());i.appendChild(this.mo(")"));return i};h.symbols={alpha:"\u03B1",beta:"\u03B2",gamma:"\u03B3",delta:"\u03B4",epsilon:"\u03B5",zeta:"\u03B6",eta:"\u03B7",theta:"\u03B8",iota:"\u03B9",kappa:"\u03BA",lambda:"\u03BB",mu:"\u03BC",nu:"\u03BD",xi:"\u03BE",omicron:"\u03BF",pi:"\u03C0",rho:"\u03C1",sigma:"\u03C3",tau:"\u03C4",upsilon:"\u03C5",phi:"\u03C6",chi:"\u03C7",psi:"\u03C8",omega:"\u03C9",Alpha:"\u0391",Beta:"\u0392",Gamma:"\u0393",Delta:"\u0394",Epsilon:"\u0395",Zeta:"\u0396",Eta:"\u0397",Theta:"\u0398",Iota:"\u0399",Kappa:"\u039A",Lambda:"\u039B",Mu:"\u039C",Nu:"\u039D",Xi:"\u039E",Omicron:"\u039F",Pi:"\u03A0",Rho:"\u03A1",Sigma:"\u03A3",Tau:"\u03A4",Upsilon:"\u03A5",Phi:"\u03A6",Chi:"\u03A7",Psi:"\u03A8",Omega:"\u03A9","#":"\u2260",">=":"\u2265","<=":"\u2264",inf:"\u221E",minf:"-\u221E"};function d(n,l,k,j,i,m){this.id=n;this.arity=l;this.lbp=k;this.rbp=j;this.nud=i;this.led=m}d.UNKNOWN=0;d.UNARY=1;d.BINARY=2;d.TERNARY=3;function a(i,k,j){this.msg=i;this.from=k;if(j){this.to=j}else{this.to=this.from}}a.prototype.toString=function(){return(this.msg+" at "+this.from+" - "+this.to)};function e(){this.defs=new f();this.defs.define();this.operators=this.defs.operators;this.oph={};for(var j=0;j<this.operators.length;j++){this.oph[this.operators[j].id]=this.operators[j]}}e.prototype.expression=function(i){var k;var j=this.current_token;if(j==null){throw new a("Expected something at the end",this.tokens[this.tokens.length-1].to+1)}this.advance();if(j.op==null){k=new h(j.type,null,j.value,null)}else{if(j.op.nud==null){throw new a("Unexpected operator '"+j.op.id+"'",j.from)}else{k=j.op.nud(this)}}while(this.current_token!=null&&this.current_token.op!=null&&i<this.current_token.op.lbp){j=this.current_token;this.advance();k=j.op.led(this,k)}return k};e.prototype.advance=function(i){if(i&&(this.current_token==null||this.current_token.op==null||this.current_token.op.id!==i)){if(this.current_token==null){throw new a("Expected '"+i+"' at the end",this.tokens[this.tokens.length-1].to+1)}else{throw new a("Expected '"+i+"'",this.current_token.from)}}if(this.token_nr>=this.tokens.length){this.current_token=null;return}this.current_token=this.tokens[this.token_nr];this.token_nr+=1};e.prototype.parse=function(k){var j=new c(this.defs,k);this.tokens=j.tokenize();if(this.tokens.length==0){return null}this.token_nr=0;this.current_token=this.tokens[this.token_nr];this.advance();var i=this.expression(0);if(this.current_token!=null){throw new a("Expected the end",this.current_token.from)}return i};function g(i,m,l,j,k){this.type=i;this.from=m;this.to=l;this.value=j;this.op=k}g.UNKNOWN=0;g.NAME=1;g.NUMBER=2;g.OPERATOR=3;function c(i,j){this.defs=i;this.text=j}c.prototype.tokenize=function(){var r,j,m,q,l,k;j=0;r=this.text.charAt(j);l=[];main:while(r){q=j;if(r<=" "){j++;r=this.text.charAt(j);continue}if((r>="0"&&r<="9")||((r===f.DECIMAL_SIGN_1||r===f.DECIMAL_SIGN_2)&&(this.text.charAt(j+1)>="0"&&this.text.charAt(j+1)<="9"))){k="";if(r!==f.DECIMAL_SIGN_1&&r!==f.DECIMAL_SIGN_2){j++;k+=r;for(;;){r=this.text.charAt(j);if(r<"0"||r>"9"){break}j++;k+=r}}if(r===f.DECIMAL_SIGN_1||r===f.DECIMAL_SIGN_2){j++;k+=r;for(;;){r=this.text.charAt(j);if(r<"0"||r>"9"){break}j+=1;k+=r}}if(r==="e"||r==="E"){j++;k+=r;r=this.text.charAt(j);if(r==="-"||r==="+"){j++;k+=r;r=this.text.charAt(j)}if(r<"0"||r>"9"){throw new a("syntax error in number exponent",q,j)}do{j++;k+=r;r=this.text.charAt(j)}while(r>="0"&&r<="9")}if((r>="a"&&r<="z")||(r>="A"&&r<="Z")){throw new a("syntax error in number",q,j)}var p=+k.replace(f.DECIMAL_SIGN_1,".").replace(f.DECIMAL_SIGN_2,".");if(isFinite(p)){l.push(new g(g.NUMBER,q,j-1,k,null));continue}else{throw new a("syntax error in number",q,j)}}for(m=0;m<this.defs.operators.length;m++){var o=this.defs.operators[m];if(this.text.substring(j,j+o.id.length)===o.id){j+=o.id.length;r=this.text.charAt(j);l.push(new g(g.OPERATOR,q,j-1,o.id,o));continue main}}if((r>="a"&&r<="z")||(r>="A"&&r<="Z")){k=r;j++;for(;;){r=this.text.charAt(j);if((r>="a"&&r<="z")||(r>="A"&&r<="Z")||(r>="0"&&r<="9")||r==="_"){k+=r;j++}else{break}}l.push(new g(g.NAME,q,j-1,k,null));continue}throw new a("unrecognized operator",q,j)}return l};var b=function(l){var m,k,n,i,j,p;m=l.ta;k=l.output_div;n=m.value;if(n!=l.oldtxt){l.oldtxt=n;while(k.firstChild!=null){k.removeChild(k.firstChild)}k.removeAttribute("title");if(n!=""){i=new e();try{p=i.parse(n);if(p!=null){var q=document.createElement("math");q.setAttribute("display","block");q.appendChild(p.toMathML());k.appendChild(q);MathJax.Hub.Queue(["Typeset",MathJax.Hub,k])}}catch(o){j="error: "+o;k.setAttribute("title",j);if(o instanceof a){k.appendChild(document.createTextNode(n.substring(0,o.from)));var r=document.createElement("span");r.appendChild(document.createTextNode(n.substring(o.from,o.to+1)));r.className="maxima-error";k.appendChild(r);if(o.to<n.length-1){k.appendChild(document.createTextNode(n.substring(o.to+1)))}}else{var s=document.createTextNode(j);k.appendChild(s)}}}}};window.addEventListener("load",function(n){var q=[];var o=document.getElementsByClassName("maxima");for(var l=0;l<o.length;l++){var m=o[l];var k=document.createElement("div");if(m.nextSibling){m.parentNode.insertBefore(k,m.nextSibling)}else{m.parentNode.appendChild(k)}var r="";q[l]={ta:m,output_div:k,oldtxt:r};var j=function(i){return function(s){b(q[i])}};var p=j(l);if(m.value!=r){p()}m.addEventListener("change",p,false);m.addEventListener("keyup",p,false)}},false)}());