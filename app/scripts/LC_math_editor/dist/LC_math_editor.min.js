var LCMATH=function(){function d(){this.operators=[]}d.ARG_SEPARATOR=";";d.DECIMAL_SIGN_1=".";d.DECIMAL_SIGN_2=",";d.INTERVAL_SEPARATOR=":";d.prototype.operator=function(p,n,m,l,k,o){this.operators.push(new j(p,n,m,l,k,o))};d.prototype.separator=function(k){this.operator(k,j.BINARY,0,0,null,null)};d.prototype.infix=function(p,m,l,o){var n,k;n=j.BINARY;k=null;o=o||function(s,r){var q=[r,s.expression(l)];return new h(h.OPERATOR,this,p,q)};this.operator(p,n,m,l,k,o)};d.prototype.prefix=function(p,l,k){var n,m,o;n=j.UNARY;m=0;k=k||function(r){var q=[r.expression(l)];return new h(h.OPERATOR,this,p,q)};o=null;this.operator(p,n,m,l,k,o)};d.prototype.suffix=function(p,m,o){var n,l,k;n=j.UNARY;l=0;k=null;o=o||function(s,r){var q=[r];return new h(h.OPERATOR,this,p,q)};this.operator(p,n,m,l,k,o)};d.prototype.findOperator=function(l){for(var k=0;k<this.operators.length;k++){if(this.operators[k].id==l){return(this.operators[k])}}return null};d.prototype.buildInterval=function(k,o,q,n){n.advance(d.INTERVAL_SEPARATOR);var m=n.expression(0);if(n.current_token==null||n.current_token.op==null||(n.current_token.op.id!==")"&&n.current_token.op.id!=="]")){throw new c("Wrong interval syntax.",n.tokens[n.token_nr-1].from)}var l;if(n.current_token.op.id==")"){n.advance(")");if(k){l=h.CLOSED_OPEN}else{l=h.OPEN_OPEN}}else{n.advance("]");if(k){l=h.CLOSED_CLOSED}else{l=h.OPEN_CLOSED}}return new h(h.INTERVAL,q,null,[o,m],l)};d.prototype.define=function(){this.suffix("!",160);this.infix("^",140,139);this.infix(".",130,129);this.infix("`",125,125,function(l,n){var v=l.expression(125);while(l.current_token!=null&&"*/".indexOf(l.current_token.value)!=-1){var s=l.tokens[l.token_nr];if(s==null){break}if(s.type!=a.NAME&&s.value!="("){break}var q=l.tokens[l.token_nr+1];if(q!=null&&(q.value=="("||q.type==a.NUMBER)){break}if(l.unit_mode&&l.tokens[l.token_nr].type==a.NAME){var u=l.tokens[l.token_nr].value;var r=false;for(var o=0;o<l.constants.length;o++){if(u==l.constants[o]){r=true;break}}if(r){break}}var w=l.current_token;l.advance();v=w.op.led(l,v)}var m=[n,v];return new h(h.OPERATOR,this,"`",m)});this.infix("*",120,120);this.infix("/",120,120);this.infix("%",120,120);this.infix("+",100,100);this.operator("-",j.BINARY,100,134,function(m){var l=[m.expression(134)];return new h(h.OPERATOR,this,"-",l)},function(n,m){var l=[m,n.expression(100)];return new h(h.OPERATOR,this,"-",l)});this.infix("=",80,80);this.infix("#",80,80);this.infix("<=",80,80);this.infix(">=",80,80);this.infix("<",80,80);this.infix(">",80,80);this.separator(")");this.separator(d.ARG_SEPARATOR);this.separator(d.INTERVAL_SEPARATOR);var k=this;this.operator("(",j.BINARY,200,200,function(m){var l=m.expression(0);if(m.current_token!=null&&m.current_token.op!=null&&m.current_token.op.id==d.INTERVAL_SEPARATOR){return k.buildInterval(false,l,this,m)}m.advance(")");return l},function(n,m){if(m.type!=h.NAME&&m.type!=h.SUBSCRIPT){throw new c("Function name expected before a parenthesis.",n.tokens[n.token_nr-1].from)}var l=[m];if(n.current_token==null||n.current_token.op==null||n.current_token.op.id!==")"){while(true){l.push(n.expression(0));if(n.current_token==null||n.current_token.op==null||n.current_token.op.id!==d.ARG_SEPARATOR){break}n.advance(d.ARG_SEPARATOR)}}n.advance(")");return new h(h.FUNCTION,this,"(",l)});this.separator("]");this.operator("[",j.BINARY,200,70,function(n){var l=[];if(n.current_token==null||n.current_token.op==null||n.current_token.op.id!=="]"){var m=n.expression(0);if(n.current_token!=null&&n.current_token.op!=null&&n.current_token.op.id==d.INTERVAL_SEPARATOR){return k.buildInterval(true,m,this,n)}while(true){l.push(m);if(n.current_token==null||n.current_token.op==null||n.current_token.op.id!==d.ARG_SEPARATOR){break}n.advance(d.ARG_SEPARATOR);m=n.expression(0)}}n.advance("]");return new h(h.VECTOR,this,null,l)},function(n,m){if(m.type!=h.NAME&&m.type!=h.SUBSCRIPT){throw new c("Name expected before a square bracket.",n.tokens[n.token_nr-1].from)}var l=[m];if(n.current_token==null||n.current_token.op==null||n.current_token.op.id!=="]"){while(true){l.push(n.expression(0));if(n.current_token==null||n.current_token.op==null||n.current_token.op.id!==d.ARG_SEPARATOR){break}n.advance(d.ARG_SEPARATOR)}}n.advance("]");return new h(h.SUBSCRIPT,this,"[",l)});this.separator("}");this.prefix("{",200,function(m){var l=[];if(m.current_token==null||m.current_token.op==null||m.current_token.op.id!=="}"){while(true){l.push(m.expression(0));if(m.current_token==null||m.current_token.op==null||m.current_token.op.id!==d.ARG_SEPARATOR){break}m.advance(d.ARG_SEPARATOR)}}m.advance("}");return new h(h.SET,this,null,l)})};"use strict";function h(m,o,n,k,l){this.type=m;this.op=o;this.value=n;this.children=k;if(typeof l=="undefined"){this.interval_type=h.NOT_AN_INTERVAL}else{this.interval_type=l}}h.UNKNOWN=0;h.NAME=1;h.NUMBER=2;h.OPERATOR=3;h.FUNCTION=4;h.VECTOR=5;h.INTERVAL=6;h.SET=7;h.SUBSCRIPT=8;h.COLORS=["#E01010","#0010FF","#009000","#FF00FF","#00B0B0","#F09000","#800080","#F080A0","#6090F0","#902000","#70A050","#A07060","#5000FF","#E06050","#008080","#808000"];h.NOT_AN_INTERVAL=0;h.OPEN_OPEN=1;h.OPEN_CLOSED=2;h.CLOSED_OPEN=3;h.CLOSED_CLOSED=4;h.prototype.toString=function(){var l="(";switch(this.type){case h.UNKNOWN:l+="UNKNOWN";break;case h.NAME:l+="NAME";break;case h.NUMBER:l+="NUMBER";break;case h.OPERATOR:l+="OPERATOR";break;case h.FUNCTION:l+="FUNCTION";break;case h.VECTOR:l+="VECTOR";break;case h.INTERVAL:l+="INTERVAL";break;case h.SET:l+="SET";break;case h.SUBSCRIPT:l+="SUBSCRIPT";break}if(this.op){l+=" '"+this.op.id+"'"}if(this.value){l+=" '"+this.value+"'"}if(this.children){l+=" [";for(var k=0;k<this.children.length;k++){l+=this.children[k].toString();if(k!=this.children.length-1){l+=","}}l+="]"}if(this.interval_type){l+=" "+this.interval_type}l+=")";return l};h.prototype.getColorForIdentifier=function(k,m){var l=m[k];if(!l){l=h.COLORS[Object.keys(m).length%h.COLORS.length];m[k]=l}return l};h.prototype.toMathML=function(m){var I,H,E,D,C,L,J,l,z,A,K,p,w,B,r,k;if(typeof m=="undefined"){m={hcolors:{},depth:0}}if(this.children!=null&&this.children.length>0){I=this.children[0]}else{I=null}if(this.children!=null&&this.children.length>1){H=this.children[1]}else{H=null}if(this.children!=null&&this.children.length>2){E=this.children[2]}else{E=null}if(this.children!=null&&this.children.length>3){D=this.children[3]}else{D=null}if(this.children!=null&&this.children.length>4){C=this.children[4]}else{C=null}switch(this.type){case h.UNKNOWN:l=document.createElement("mtext");l.appendChild(document.createTextNode("???"));return(l);case h.NAME:if(this.value.search(/^[a-zA-Z]+[0-9]+$/)>=0){var v=this.value.search(/[0-9]/);B=document.createElement("msub");B.appendChild(this.mi(this.value.substring(0,v)));B.appendChild(this.mn(this.value.substring(v)));l=B}else{l=this.mi(this.value)}l.setAttribute("mathcolor",this.getColorForIdentifier(this.value,m.hcolors));return(l);case h.NUMBER:if(this.value.indexOf("e")!=-1||this.value.indexOf("E")!=-1){var t=this.value.indexOf("e");if(t==-1){t=this.value.indexOf("E")}A=document.createElement("mrow");A.appendChild(this.mn(this.value.substring(0,t)));A.appendChild(this.mo("\u22C5"));r=document.createElement("msup");r.appendChild(this.mn(10));r.appendChild(this.mn(this.value.substring(t+1)));A.appendChild(r);return(A)}return(this.mn(this.value));case h.OPERATOR:if(this.value=="/"){w=document.createElement("mfrac");w.appendChild(I.toMathML(m));w.appendChild(H.toMathML(m));l=w}else{if(this.value=="^"){if(I.type==h.FUNCTION){if(I.value=="sqrt"||I.value=="abs"||I.value=="matrix"||I.value=="diff"){z=false}else{z=true}}else{if(I.type==h.OPERATOR){z=true}else{z=false}}l=document.createElement("msup");if(z){l.appendChild(this.addP(I,m))}else{l.appendChild(I.toMathML(m))}l.appendChild(H.toMathML(m))}else{if(this.value=="*"){A=document.createElement("mrow");if(I.type==h.OPERATOR&&(I.value=="+"||I.value=="-")){A.appendChild(this.addP(I,m))}else{A.appendChild(I.toMathML(m))}var M=H;while(M.type==h.OPERATOR){M=M.children[0]}if(I.type==h.VECTOR&&H.type==h.VECTOR){A.appendChild(this.mo("*"))}else{if(M.type==h.NUMBER){A.appendChild(this.mo("\u22C5"))}}if(H.type==h.OPERATOR&&(H.value=="+"||H.value=="-")){A.appendChild(this.addP(H,m))}else{A.appendChild(H.toMathML(m))}l=A}else{if(this.value=="-"){A=document.createElement("mrow");if(this.children.length==1){A.appendChild(this.mo("-"));A.appendChild(I.toMathML(m))}else{A.appendChild(I.toMathML(m));A.appendChild(this.mo("-"));if(H.type==h.OPERATOR&&(H.value=="+"||H.value=="-")){A.appendChild(this.addP(H,m))}else{A.appendChild(H.toMathML(m))}}l=A}else{if(this.value=="!"){A=document.createElement("mrow");K=this.mo(this.value);if(I.type==h.OPERATOR&&(I.value=="+"||I.value=="-")){A.appendChild(this.addP(I,m))}else{A.appendChild(I.toMathML(m))}A.appendChild(K);l=A}else{if(this.value=="+"){A=document.createElement("mrow");K=this.mo(this.value);A.appendChild(I.toMathML(m));A.appendChild(K);z=false;var s=H;while(s.type==h.OPERATOR){if(s.value=="-"&&s.children.length==1){z=true;break}else{if(s.value=="+"||s.value=="-"||s.value=="*"){s=s.children[0]}else{break}}}if(z){A.appendChild(this.addP(H,m))}else{A.appendChild(H.toMathML(m))}l=A}else{if(this.value=="."){A=document.createElement("mrow");if(I.type==h.OPERATOR&&(I.value=="+"||I.value=="-")){A.appendChild(this.addP(I,m))}else{A.appendChild(I.toMathML(m))}A.appendChild(this.mo("\u22C5"));if(H.type==h.OPERATOR&&(H.value=="+"||H.value=="-")){A.appendChild(this.addP(H,m))}else{A.appendChild(H.toMathML(m))}l=A}else{if(this.value=="`"){A=document.createElement("mrow");if(I.type==h.OPERATOR&&(I.value=="+"||I.value=="-")){A.appendChild(this.addP(I,m))}else{A.appendChild(I.toMathML(m))}var n=document.createElement("mstyle");n.setAttribute("fontstyle","normal");if(H.type==h.OPERATOR&&(H.value=="+"||H.value=="-")){n.appendChild(this.addP(H,m))}else{n.appendChild(H.toMathML(m))}A.appendChild(n);l=A}else{A=document.createElement("mrow");K=this.mo(this.value);A.appendChild(I.toMathML(m));A.appendChild(K);A.appendChild(H.toMathML(m));l=A}}}}}}}}return(l);case h.FUNCTION:if(I.value=="sqrt"&&H!=null){l=document.createElement("msqrt");l.appendChild(H.toMathML(m))}else{if(I.value=="abs"&&H!=null){A=document.createElement("mrow");A.appendChild(this.mo("|"));A.appendChild(H.toMathML(m));A.appendChild(this.mo("|"));l=A}else{if(I.value=="exp"&&H!=null){l=document.createElement("msup");l.appendChild(this.mi("e"));l.appendChild(H.toMathML(m))}else{if(I.value=="factorial"){A=document.createElement("mrow");K=this.mo("!");if(H.type==h.OPERATOR&&(H.value=="+"||H.value=="-")){A.appendChild(this.addP(H,m))}else{A.appendChild(H.toMathML(m))}A.appendChild(K);l=A}else{if(I.value=="diff"&&this.children!=null&&this.children.length==3){A=document.createElement("mrow");w=document.createElement("mfrac");w.appendChild(this.mi("d"));var G=document.createElement("mrow");G.appendChild(this.mi("d"));G.appendChild(this.mi(E.value));w.appendChild(G);A.appendChild(w);if(H.type==h.OPERATOR&&(H.value=="+"||H.value=="-")){A.appendChild(this.addP(H,m))}else{A.appendChild(H.toMathML(m))}l=A}else{if(I.value=="diff"&&this.children!=null&&this.children.length==4){A=document.createElement("mrow");w=document.createElement("mfrac");r=document.createElement("msup");r.appendChild(this.mi("d"));r.appendChild(D.toMathML(m));w.appendChild(r);var G=document.createElement("mrow");G.appendChild(this.mi("d"));r=document.createElement("msup");r.appendChild(E.toMathML(m));r.appendChild(D.toMathML(m));G.appendChild(r);w.appendChild(G);A.appendChild(w);if(H.type==h.OPERATOR&&(H.value=="+"||H.value=="-")){A.appendChild(this.addP(H,m))}else{A.appendChild(H.toMathML(m))}l=A}else{if(I.value=="integrate"&&this.children!=null&&this.children.length==3){A=document.createElement("mrow");var K=this.mo("\u222B");K.setAttribute("stretchy","true");A.appendChild(K);if(E.type==h.OPERATOR&&(E.value=="+"||E.value=="-")){A.appendChild(this.addP(H,m))}else{A.appendChild(H.toMathML(m))}A.appendChild(this.mi("d"));A.appendChild(E.toMathML(m));l=A}else{if(I.value=="integrate"&&this.children!=null&&this.children.length==5){A=document.createElement("mrow");var x=document.createElement("msubsup");var K=this.mo("\u222B");K.setAttribute("stretchy","true");x.appendChild(K);x.appendChild(D.toMathML(m));x.appendChild(C.toMathML(m));A.appendChild(x);if(E.type==h.OPERATOR&&(E.value=="+"||E.value=="-")){A.appendChild(this.addP(H,m))}else{A.appendChild(H.toMathML(m))}A.appendChild(this.mi("d"));A.appendChild(E.toMathML(m));l=A}else{if(I.value=="sum"&&this.children!=null&&this.children.length==5){A=document.createElement("mrow");var q=document.createElement("munderover");var K=this.mo("\u2211");K.setAttribute("stretchy","true");q.appendChild(K);k=document.createElement("mrow");k.appendChild(E.toMathML(m));k.appendChild(this.mo("="));k.appendChild(D.toMathML(m));q.appendChild(k);q.appendChild(C.toMathML(m));A.appendChild(q);if(E.type==h.OPERATOR&&(E.value=="+"||E.value=="-")){A.appendChild(this.addP(H,m))}else{A.appendChild(H.toMathML(m))}l=A}else{if(I.value=="product"&&this.children!=null&&this.children.length==5){A=document.createElement("mrow");var q=document.createElement("munderover");var K=this.mo("\u220F");K.setAttribute("stretchy","true");q.appendChild(K);k=document.createElement("mrow");k.appendChild(E.toMathML(m));k.appendChild(this.mo("="));k.appendChild(D.toMathML(m));q.appendChild(k);q.appendChild(C.toMathML(m));A.appendChild(q);if(E.type==h.OPERATOR&&(E.value=="+"||E.value=="-")){A.appendChild(this.addP(H,m))}else{A.appendChild(H.toMathML(m))}l=A}else{if(I.value=="limit"){A=document.createElement("mrow");if(this.children.length<4){A.appendChild(this.mo("lim"))}else{var o=document.createElement("munder");o.appendChild(this.mo("lim"));var F=document.createElement("mrow");F.appendChild(E.toMathML(m));F.appendChild(this.mo("\u2192"));F.appendChild(D.toMathML(m));if(C!=null){if(C.value=="plus"){F.appendChild(this.mo("+"))}else{if(C.value=="minus"){F.appendChild(this.mo("-"))}}}o.appendChild(F);A.appendChild(o)}A.appendChild(H.toMathML(m));l=A}else{if(I.value=="binomial"){A=document.createElement("mrow");A.appendChild(this.mo("("));p=document.createElement("mtable");for(L=1;L<this.children.length;L++){var u=document.createElement("mtr");u.appendChild(this.children[L].toMathML(m));p.appendChild(u)}A.appendChild(p);A.appendChild(this.mo(")"));l=A}else{if(I.value=="matrix"){for(L=1;L<this.children.length;L++){if(this.children[L].type!==h.VECTOR){l=document.createElement("mtext");l.appendChild(document.createTextNode("???"));return(l)}}A=document.createElement("mrow");A.appendChild(this.mo("("));p=document.createElement("mtable");for(L=1;L<this.children.length;L++){var u=document.createElement("mtr");for(J=0;J<this.children[L].children.length;J++){u.appendChild(this.children[L].children[J].toMathML(m))}p.appendChild(u)}A.appendChild(p);A.appendChild(this.mo(")"));l=A}else{if(I.value=="union"&&this.children.length==3){for(L=1;L<this.children.length;L++){if(this.children[L].type!==h.INTERVAL&&this.children[L].type!==h.SET){l=document.createElement("mtext");l.appendChild(document.createTextNode("???"));return(l)}}A=document.createElement("mrow");A.appendChild(H.toMathML(m));A.appendChild(this.mo("\u222A"));A.appendChild(E.toMathML(m));l=A}else{if(I.value=="intersection"&&this.children.length==3){for(L=1;L<this.children.length;L++){if(this.children[L].type!==h.INTERVAL&&this.children[L].type!==h.SET){l=document.createElement("mtext");l.appendChild(document.createTextNode("???"));return(l)}}A=document.createElement("mrow");A.appendChild(H.toMathML(m));A.appendChild(this.mo("\u2229"));A.appendChild(E.toMathML(m));l=A}else{A=document.createElement("mrow");A.appendChild(I.toMathML(m));A.appendChild(this.mo("("));for(L=1;L<this.children.length;L++){A.appendChild(this.children[L].toMathML(m));if(L<this.children.length-1){A.appendChild(this.mo(d.ARG_SEPARATOR))}}A.appendChild(this.mo(")"));l=A}}}}}}}}}}}}}}}return(l);case h.VECTOR:var y=true;for(L=0;L<this.children.length;L++){if(this.children[L].type!==h.VECTOR){y=false}}A=document.createElement("mrow");A.appendChild(this.mo("("));p=document.createElement("mtable");for(L=0;L<this.children.length;L++){var u=document.createElement("mtr");if(y){for(J=0;J<this.children[L].children.length;J++){u.appendChild(this.children[L].children[J].toMathML(m))}}else{u.appendChild(this.children[L].toMathML(m))}p.appendChild(u)}A.appendChild(p);A.appendChild(this.mo(")"));return(A);case h.INTERVAL:A=document.createElement("mrow");if(this.interval_type==h.OPEN_OPEN||this.interval_type==h.OPEN_CLOSED){K=this.mo("(")}else{K=this.mo("[")}A.appendChild(K);k=document.createElement("mrow");k.appendChild(this.children[0].toMathML(m));k.appendChild(this.mo(":"));k.appendChild(this.children[1].toMathML(m));A.appendChild(k);if(this.interval_type==h.OPEN_OPEN||this.interval_type==h.CLOSED_OPEN){K=this.mo(")")}else{K=this.mo("]")}A.appendChild(K);return(A);case h.SET:A=document.createElement("mrow");A.appendChild(this.mo("{"));k=document.createElement("mrow");for(L=0;L<this.children.length;L++){if(L>0){k.appendChild(this.mo(";"))}k.appendChild(this.children[L].toMathML(m))}A.appendChild(k);A.appendChild(this.mo("}"));return(A);case h.SUBSCRIPT:B=document.createElement("msub");B.appendChild(I.toMathML(m));if(this.children.length>2){A=document.createElement("mrow");for(L=1;L<this.children.length;L++){A.appendChild(this.children[L].toMathML(m));if(L<this.children.length-1){A.appendChild(this.mo(d.ARG_SEPARATOR))}}B.appendChild(A)}else{B.appendChild(H.toMathML(m))}return(B)}};h.prototype.mi=function(l){var k=document.createElement("mi");if(h.symbols[l]){l=h.symbols[l]}k.appendChild(document.createTextNode(l));return k};h.prototype.mn=function(l){var k=document.createElement("mn");k.appendChild(document.createTextNode(l));return k};h.prototype.mo=function(k){var l=document.createElement("mo");if(h.symbols[k]){k=h.symbols[k]}l.appendChild(document.createTextNode(k));return l};h.prototype.addP=function(l,m){var k,n;k=document.createElement("mrow");n=this.mo("(");n.setAttribute("mathcolor",h.COLORS[m.depth%h.COLORS.length]);k.appendChild(n);m.depth++;k.appendChild(l.toMathML(m));m.depth--;n=this.mo(")");n.setAttribute("mathcolor",h.COLORS[m.depth%h.COLORS.length]);k.appendChild(n);return k};h.symbols={alpha:"\u03B1",beta:"\u03B2",gamma:"\u03B3",delta:"\u03B4",epsilon:"\u03B5",zeta:"\u03B6",eta:"\u03B7",theta:"\u03B8",iota:"\u03B9",kappa:"\u03BA",lambda:"\u03BB",mu:"\u03BC",nu:"\u03BD",xi:"\u03BE",omicron:"\u03BF",pi:"\u03C0",rho:"\u03C1",sigma:"\u03C3",tau:"\u03C4",upsilon:"\u03C5",phi:"\u03C6",chi:"\u03C7",psi:"\u03C8",omega:"\u03C9",Alpha:"\u0391",Beta:"\u0392",Gamma:"\u0393",Delta:"\u0394",Epsilon:"\u0395",Zeta:"\u0396",Eta:"\u0397",Theta:"\u0398",Iota:"\u0399",Kappa:"\u039A",Lambda:"\u039B",Mu:"\u039C",Nu:"\u039D",Xi:"\u039E",Omicron:"\u039F",Pi:"\u03A0",Rho:"\u03A1",Sigma:"\u03A3",Tau:"\u03A4",Upsilon:"\u03A5",Phi:"\u03A6",Chi:"\u03A7",Psi:"\u03A8",Omega:"\u03A9","#":"\u2260",">=":"\u2265","<=":"\u2264",inf:"\u221E",minf:"-\u221E",hbar:"\u210F",G:"\uD835\uDCA2"};"use strict";function j(p,n,m,l,k,o){this.id=p;this.arity=n;this.lbp=m;this.rbp=l;this.nud=k;this.led=o}j.UNKNOWN=0;j.UNARY=1;j.BINARY=2;j.TERNARY=3;"use strict";function c(k,m,l){this.msg=k;this.from=m;if(l){this.to=l}else{this.to=this.from}}c.prototype.toString=function(){return(this.msg+" at "+this.from+" - "+this.to)};"use strict";function e(n,k,m){if(typeof n=="undefined"){this.implicit_operators=false}else{this.implicit_operators=n}if(typeof k=="undefined"){this.unit_mode=false}else{this.unit_mode=k}if(typeof m=="undefined"){this.constants=[]}else{this.constants=m}this.defs=new d();this.defs.define();this.operators=this.defs.operators;this.oph={};for(var l=0;l<this.operators.length;l++){this.oph[this.operators[l].id]=this.operators[l]}}e.prototype.expression=function(k){var m;var l=this.current_token;if(l==null){throw new c("Expected something at the end",this.tokens[this.tokens.length-1].to+1)}this.advance();if(l.op==null){m=new h(l.type,null,l.value,null)}else{if(l.op.nud==null){throw new c("Unexpected operator '"+l.op.id+"'",l.from)}else{m=l.op.nud(this)}}while(this.current_token!=null&&this.current_token.op!=null&&k<this.current_token.op.lbp){l=this.current_token;this.advance();m=l.op.led(this,m)}return m};e.prototype.advance=function(k){if(k&&(this.current_token==null||this.current_token.op==null||this.current_token.op.id!==k)){if(this.current_token==null){throw new c("Expected '"+k+"' at the end",this.tokens[this.tokens.length-1].to+1)}else{throw new c("Expected '"+k+"'",this.current_token.from)}}if(this.token_nr>=this.tokens.length){this.current_token=null;return}this.current_token=this.tokens[this.token_nr];this.token_nr+=1};e.prototype.addHiddenOperators=function(){var w=this.defs.findOperator("*");var q=this.defs.findOperator("`");var p=false;var k=false;for(var o=0;o<this.tokens.length-1;o++){var l=this.tokens[o];var s=this.tokens[o+1];if(this.unit_mode){if(l.value=="`"){p=true}else{if(p){if(l.value=="^"){k=true}else{if(k&&l.type==a.NUMBER){k=false}else{if(!k&&l.type==a.NUMBER){p=false}else{if(l.type==a.OPERATOR&&"*/^()".indexOf(l.value)==-1){p=false}else{if(l.type==a.NAME&&s.value=="("){p=false}}}}}}}}if((l.type==a.NAME&&s.type==a.NAME)||(l.type==a.NUMBER&&s.type==a.NAME)||(l.type==a.NUMBER&&s.type==a.NUMBER)||(l.type==a.NUMBER&&(s.value=="("||s.value=="["||s.value=="{"))||((l.value==")"||l.value=="]"||l.value=="}")&&s.type==a.NAME)||((l.value==")"||l.value=="]"||l.value=="}")&&s.type==a.NUMBER)||((l.value==")"||l.value=="]"||l.value=="}")&&s.value=="(")){var r=(this.unit_mode&&!p&&(l.type==a.NUMBER||(l.value==")"||l.value=="]"||l.value=="}"))&&(s.type==a.NAME||((s.value=="("||s.value=="["||s.value=="{")&&this.tokens.length>o+2&&this.tokens[o+2].type==a.NAME)));if(r){var v,u;if(s.type==a.NAME){v=s;u=o+1}else{u=o+2;v=this.tokens[u]}for(var n=0;n<this.constants.length;n++){if(v.value==this.constants[n]){r=false;break}}if(this.tokens.length>u+1&&this.tokens[u+1].value=="("){var t=["pow","sqrt","abs","exp","factorial","diff","integrate","sum","product","limit","binomial","matrix","ln","log","log10","mod","signum","ceiling","floor","sin","cos","tan","asin","acos","atan","atan2","sinh","cosh","tanh","asinh","acosh","atanh"];for(var n=0;n<t.length;n++){if(v.value==t[n]){r=false;break}}}}var m;if(r){m=new a(a.OPERATOR,s.from,s.from,q.id,q);p=true}else{m=new a(a.OPERATOR,s.from,s.from,w.id,w)}this.tokens.splice(o+1,0,m)}}};e.prototype.parse=function(m){var l=new i(this.defs,m);this.tokens=l.tokenize();if(this.tokens.length==0){return null}if(this.implicit_operators){this.addHiddenOperators()}this.token_nr=0;this.current_token=this.tokens[this.token_nr];this.advance();var k=this.expression(0);if(this.current_token!=null){throw new c("Expected the end",this.current_token.from)}return k};"use strict";function a(k,o,n,l,m){this.type=k;this.from=o;this.to=n;this.value=l;this.op=m}a.UNKNOWN=0;a.NAME=1;a.NUMBER=2;a.OPERATOR=3;"use strict";function i(k,l){this.defs=k;this.text=l}i.prototype.tokenize=function(){var s,k,o,r,m,l;k=0;s=this.text.charAt(k);m=[];main:while(s){r=k;if(s<=" "){k++;s=this.text.charAt(k);continue}if((s>="0"&&s<="9")||((s===d.DECIMAL_SIGN_1||s===d.DECIMAL_SIGN_2)&&(this.text.charAt(k+1)>="0"&&this.text.charAt(k+1)<="9"))){l="";if(s!==d.DECIMAL_SIGN_1&&s!==d.DECIMAL_SIGN_2){k++;l+=s;for(;;){s=this.text.charAt(k);if(s<"0"||s>"9"){break}k++;l+=s}}if(s===d.DECIMAL_SIGN_1||s===d.DECIMAL_SIGN_2){k++;l+=s;for(;;){s=this.text.charAt(k);if(s<"0"||s>"9"){break}k+=1;l+=s}}if(s==="e"||s==="E"){k++;l+=s;s=this.text.charAt(k);if(s==="-"||s==="+"){k++;l+=s;s=this.text.charAt(k)}if(s<"0"||s>"9"){throw new c("syntax error in number exponent",r,k)}do{k++;l+=s;s=this.text.charAt(k)}while(s>="0"&&s<="9")}var q=+l.replace(d.DECIMAL_SIGN_1,".").replace(d.DECIMAL_SIGN_2,".");if(isFinite(q)){m.push(new a(a.NUMBER,r,k-1,l,null));continue}else{throw new c("syntax error in number",r,k)}}for(o=0;o<this.defs.operators.length;o++){var p=this.defs.operators[o];if(this.text.substring(k,k+p.id.length)===p.id){k+=p.id.length;s=this.text.charAt(k);m.push(new a(a.OPERATOR,r,k-1,p.id,p));continue main}}if((s>="a"&&s<="z")||(s>="A"&&s<="Z")){l=s;k++;for(;;){s=this.text.charAt(k);if((s>="a"&&s<="z")||(s>="A"&&s<="Z")||(s>="0"&&s<="9")||s==="_"){l+=s;k++}else{break}}m.push(new a(a.NAME,r,k-1,l,null));continue}throw new c("unrecognized operator",r,k)}return m};"use strict";var g=function(s){var p,n,q,l,o,t,m,k;p=s.ta;n=s.output_node;q=p.value;m="";k=q;while(k!=m){m=k;k=m.replace(/\[[^\[\]]*\]/g,"")}if(k.split("[").length==k.split("]").length){m="";while(k!=m){m=k;k=m.replace(/\([^\(\)]*\)/g,"")}if(k.split("(").length==k.split(")").length){m="";while(k!=m){m=k;k=m.replace(/\{[^\{\}]*\}/g,"")}if(k.split("{").length==k.split("}").length){if(k.indexOf(d.ARG_SEPARATOR)!=-1){q="["+q+"]"}}}}if(q!=s.oldtxt){s.oldtxt=q;while(n.firstChild!=null){n.removeChild(n.firstChild)}n.removeAttribute("title");if(q!=""){l=s.parser;try{t=l.parse(q);if(t!=null){var u=document.createElement("math");u.setAttribute("display","block");u.appendChild(t.toMathML());n.appendChild(u);MathJax.Hub.Queue(["Typeset",MathJax.Hub,n])}}catch(r){o="error: "+r;n.setAttribute("title",o);if(r instanceof c){n.appendChild(document.createTextNode(q.substring(0,r.from)));var v=document.createElement("span");v.appendChild(document.createTextNode(q.substring(r.from,r.to+1)));v.className="math-error";n.appendChild(v);if(r.to<q.length-1){n.appendChild(document.createTextNode(q.substring(r.to+1)))}}else{var w=document.createTextNode(o);n.appendChild(w)}}}}};var b=false;var f=function(){if(b){return}b=true;var o=[];var t=document.getElementsByClassName("math");for(var m=0;m<t.length;m++){var n=t[m];if(n.nodeName=="TEXTAREA"||n.nodeName=="INPUT"){var k=document.createElement("span");k.setAttribute("style","display:none");if(n.nextSibling){n.parentNode.insertBefore(k,n.nextSibling)}else{n.parentNode.appendChild(k)}var s=function(x){return function(y){x.setAttribute("style","display:none")}};var w=function(x){return function(y){x.setAttribute("style","display: inline-block; background-color: #FFFFE0")}};n.addEventListener("blur",s(k),false);n.addEventListener("focus",w(k),false);var q=(n.getAttribute("data-implicit_operators")==="true");var p=(n.getAttribute("data-unit_mode")==="true");var u=n.getAttribute("data-constants");if(u){u=u.split(/[\s,]+/)}var v="";o[m]={ta:n,output_node:k,oldtxt:v,parser:new e(q,p,u)};var l=function(x){return function(z){var y=o[x];if(document.activeElement==y.ta){y.output_node.setAttribute("style","display: inline-block; background-color: #FFFFE0")}g(y)}};var r=l(m);if(n.value!=v){r()}n.addEventListener("change",r,false);n.addEventListener("keyup",r,false)}}};return({Definitions:d,ENode:h,Operator:j,ParseException:c,Parser:e,initEditors:f})}();