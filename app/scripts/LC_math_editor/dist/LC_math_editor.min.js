'use strict';var LCMATH=function(){function l(){this.operators=[]}function e(b,a,d,g,f){this.type=b;this.op=a;this.value=d;this.children=g;this.interval_type="undefined"==typeof f?e.NOT_AN_INTERVAL:f}function p(b,a,d,g,f,e){this.id=b;this.arity=a;this.lbp=d;this.rbp=g;this.nud=f;this.led=e}function n(b,a,d){this.msg=b;this.from=a;this.to=d?d:this.from}function r(b,a,d){this.implicit_operators="undefined"==typeof b?!1:b;this.unit_mode="undefined"==typeof a?!1:a;this.constants="undefined"==typeof d?
[]:d;this.defs=new l;this.defs.define();this.operators=this.defs.operators;this.oph={};for(b=0;b<this.operators.length;b++)this.oph[this.operators[b].id]=this.operators[b]}function s(b,a){this.defs=b;this.text=a}function m(b,a,d,g,f){this.type=b;this.from=a;this.to=d;this.value=g;this.op=f}l.ARG_SEPARATOR=";";l.DECIMAL_SIGN_1=".";l.DECIMAL_SIGN_2=",";l.INTERVAL_SEPARATOR=":";l.prototype.operator=function(b,a,d,g,f,e){this.operators.push(new p(b,a,d,g,f,e))};l.prototype.separator=function(b){this.operator(b,
p.BINARY,0,0,null,null)};l.prototype.infix=function(b,a,d,g){var f;f=p.BINARY;g=g||function(a,c){var g=[c,a.expression(d)];return new e(e.OPERATOR,this,b,g)};this.operator(b,f,a,d,null,g)};l.prototype.prefix=function(b,a,d){var g;g=p.UNARY;d=d||function(d){d=[d.expression(a)];return new e(e.OPERATOR,this,b,d)};this.operator(b,g,0,a,d,null)};l.prototype.suffix=function(b,a,d){var g;g=p.UNARY;d=d||function(a,d){return new e(e.OPERATOR,this,b,[d])};this.operator(b,g,a,0,null,d)};l.prototype.findOperator=
function(b){for(var a=0;a<this.operators.length;a++)if(this.operators[a].id==b)return this.operators[a];return null};l.prototype.buildInterval=function(b,a,d,g){g.advance(l.INTERVAL_SEPARATOR);var f=g.expression(0);if(null==g.current_token||null==g.current_token.op||")"!==g.current_token.op.id&&"]"!==g.current_token.op.id)throw new n("Wrong interval syntax.",g.tokens[g.token_nr-1].from);")"==g.current_token.op.id?(g.advance(")"),b=b?e.CLOSED_OPEN:e.OPEN_OPEN):(g.advance("]"),b=b?e.CLOSED_CLOSED:e.OPEN_CLOSED);
return new e(e.INTERVAL,d,null,[a,f],b)};l.prototype.define=function(){this.suffix("!",160);this.infix("^",140,139);this.infix(".",130,129);this.infix("`",125,125,function(a,b){for(var g=a.expression(125);null!=a.current_token&&-1!="*/".indexOf(a.current_token.value);){var f=a.tokens[a.token_nr];if(null==f)break;if(f.type!=m.NAME&&"("!=f.value)break;f=a.tokens[a.token_nr+1];if(null!=f&&("("==f.value||f.type==m.NUMBER))break;if(a.unit_mode&&a.tokens[a.token_nr].type==m.NAME){for(var f=a.tokens[a.token_nr].value,
h=!1,c=0;c<a.constants.length;c++)if(f==a.constants[c]){h=!0;break}if(h)break}f=a.current_token;a.advance();g=f.op.led(a,g)}return new e(e.OPERATOR,this,"`",[b,g])});this.infix("*",120,120);this.infix("/",120,120);this.infix("%",120,120);this.infix("+",100,100);this.operator("-",p.BINARY,100,134,function(a){a=[a.expression(134)];return new e(e.OPERATOR,this,"-",a)},function(a,b){var g=[b,a.expression(100)];return new e(e.OPERATOR,this,"-",g)});this.infix("=",80,80);this.infix("#",80,80);this.infix("<=",
80,80);this.infix(">=",80,80);this.infix("<",80,80);this.infix(">",80,80);this.separator(")");this.separator(l.ARG_SEPARATOR);this.separator(l.INTERVAL_SEPARATOR);var b=this;this.operator("(",p.BINARY,200,200,function(a){var d=a.expression(0);if(null!=a.current_token&&null!=a.current_token.op&&a.current_token.op.id==l.INTERVAL_SEPARATOR)return b.buildInterval(!1,d,this,a);a.advance(")");return d},function(a,b){if(b.type!=e.NAME&&b.type!=e.SUBSCRIPT)throw new n("Function name expected before a parenthesis.",
a.tokens[a.token_nr-1].from);var g=[b];if(null==a.current_token||null==a.current_token.op||")"!==a.current_token.op.id)for(;;){g.push(a.expression(0));if(null==a.current_token||null==a.current_token.op||a.current_token.op.id!==l.ARG_SEPARATOR)break;a.advance(l.ARG_SEPARATOR)}a.advance(")");return new e(e.FUNCTION,this,"(",g)});this.separator("]");this.operator("[",p.BINARY,200,70,function(a){var d=[];if(null==a.current_token||null==a.current_token.op||"]"!==a.current_token.op.id){var g=a.expression(0);
if(null!=a.current_token&&null!=a.current_token.op&&a.current_token.op.id==l.INTERVAL_SEPARATOR)return b.buildInterval(!0,g,this,a);for(;;){d.push(g);if(null==a.current_token||null==a.current_token.op||a.current_token.op.id!==l.ARG_SEPARATOR)break;a.advance(l.ARG_SEPARATOR);g=a.expression(0)}}a.advance("]");return new e(e.VECTOR,this,null,d)},function(a,b){if(b.type!=e.NAME&&b.type!=e.SUBSCRIPT)throw new n("Name expected before a square bracket.",a.tokens[a.token_nr-1].from);var g=[b];if(null==a.current_token||
null==a.current_token.op||"]"!==a.current_token.op.id)for(;;){g.push(a.expression(0));if(null==a.current_token||null==a.current_token.op||a.current_token.op.id!==l.ARG_SEPARATOR)break;a.advance(l.ARG_SEPARATOR)}a.advance("]");return new e(e.SUBSCRIPT,this,"[",g)});this.separator("}");this.prefix("{",200,function(a){var b=[];if(null==a.current_token||null==a.current_token.op||"}"!==a.current_token.op.id)for(;;){b.push(a.expression(0));if(null==a.current_token||null==a.current_token.op||a.current_token.op.id!==
l.ARG_SEPARATOR)break;a.advance(l.ARG_SEPARATOR)}a.advance("}");return new e(e.SET,this,null,b)})};"use strict";e.UNKNOWN=0;e.NAME=1;e.NUMBER=2;e.OPERATOR=3;e.FUNCTION=4;e.VECTOR=5;e.INTERVAL=6;e.SET=7;e.SUBSCRIPT=8;e.COLORS="#E01010 #0010FF #009000 #FF00FF #00B0B0 #F09000 #800080 #F080A0 #6090F0 #902000 #70A050 #A07060 #5000FF #E06050 #008080 #808000".split(" ");e.NOT_AN_INTERVAL=0;e.OPEN_OPEN=1;e.OPEN_CLOSED=2;e.CLOSED_OPEN=3;e.CLOSED_CLOSED=4;e.prototype.toString=function(){var b="(";switch(this.type){case e.UNKNOWN:b+=
"UNKNOWN";break;case e.NAME:b+="NAME";break;case e.NUMBER:b+="NUMBER";break;case e.OPERATOR:b+="OPERATOR";break;case e.FUNCTION:b+="FUNCTION";break;case e.VECTOR:b+="VECTOR";break;case e.INTERVAL:b+="INTERVAL";break;case e.SET:b+="SET";break;case e.SUBSCRIPT:b+="SUBSCRIPT"}this.op&&(b+=" '"+this.op.id+"'");this.value&&(b+=" '"+this.value+"'");if(this.children){for(var b=b+" [",a=0;a<this.children.length;a++)b+=this.children[a].toString(),a!=this.children.length-1&&(b+=",");b+="]"}this.interval_type&&
(b+=" "+this.interval_type);return b+")"};e.prototype.getColorForIdentifier=function(b,a){var d=a[b];d||(d=e.COLORS[Object.keys(a).length%e.COLORS.length],a[b]=d);return d};e.prototype.toMathML=function(b){var a,d,g,f,h,c,k;"undefined"==typeof b&&(b={hcolors:{},depth:0});a=null!=this.children&&0<this.children.length?this.children[0]:null;d=null!=this.children&&1<this.children.length?this.children[1]:null;g=null!=this.children&&2<this.children.length?this.children[2]:null;f=null!=this.children&&3<
this.children.length?this.children[3]:null;h=null!=this.children&&4<this.children.length?this.children[4]:null;switch(this.type){case e.UNKNOWN:return c=document.createElement("mtext"),c.appendChild(document.createTextNode("???")),c;case e.NAME:return 0<=this.value.search(/^[a-zA-Z]+[0-9]+$/)?(c=this.value.search(/[0-9]/),g=document.createElement("msub"),g.appendChild(this.mi(this.value.substring(0,c))),g.appendChild(this.mn(this.value.substring(c))),c=g):c=this.mi(this.value),c.setAttribute("mathcolor",
this.getColorForIdentifier(this.value,b.hcolors)),c;case e.NUMBER:return-1!=this.value.indexOf("e")||-1!=this.value.indexOf("E")?(b=this.value.indexOf("e"),-1==b&&(b=this.value.indexOf("E")),c=document.createElement("mrow"),c.appendChild(this.mn(this.value.substring(0,b))),c.appendChild(this.mo("\u22c5")),a=document.createElement("msup"),a.appendChild(this.mn(10)),a.appendChild(this.mn(this.value.substring(b+1))),c.appendChild(a),c):this.mn(this.value);case e.OPERATOR:if("/"==this.value)h=document.createElement("mfrac"),
h.appendChild(a.toMathML(b)),h.appendChild(d.toMathML(b)),c=h;else if("^"==this.value)g=a.type==e.FUNCTION?"sqrt"==a.value||"abs"==a.value||"matrix"==a.value||"diff"==a.value?!1:!0:a.type==e.OPERATOR?!0:!1,c=document.createElement("msup"),g?c.appendChild(this.addP(a,b)):c.appendChild(a.toMathML(b)),c.appendChild(d.toMathML(b));else if("*"==this.value){c=document.createElement("mrow");a.type!=e.OPERATOR||"+"!=a.value&&"-"!=a.value?c.appendChild(a.toMathML(b)):c.appendChild(this.addP(a,b));for(g=d;g.type==
e.OPERATOR;)g=g.children[0];a.type==e.VECTOR&&d.type==e.VECTOR?c.appendChild(this.mo("*")):g.type==e.NUMBER&&c.appendChild(this.mo("\u22c5"));d.type!=e.OPERATOR||"+"!=d.value&&"-"!=d.value?c.appendChild(d.toMathML(b)):c.appendChild(this.addP(d,b))}else if("-"==this.value)c=document.createElement("mrow"),1==this.children.length?(c.appendChild(this.mo("-")),c.appendChild(a.toMathML(b))):(c.appendChild(a.toMathML(b)),c.appendChild(this.mo("-")),d.type!=e.OPERATOR||"+"!=d.value&&"-"!=d.value?c.appendChild(d.toMathML(b)):
c.appendChild(this.addP(d,b)));else if("!"==this.value)c=document.createElement("mrow"),k=this.mo(this.value),a.type!=e.OPERATOR||"+"!=a.value&&"-"!=a.value?c.appendChild(a.toMathML(b)):c.appendChild(this.addP(a,b)),c.appendChild(k);else if("+"==this.value){c=document.createElement("mrow");k=this.mo(this.value);c.appendChild(a.toMathML(b));c.appendChild(k);g=!1;for(f=d;f.type==e.OPERATOR;)if("-"==f.value&&1==f.children.length){g=!0;break}else if("+"==f.value||"-"==f.value||"*"==f.value)f=f.children[0];
else break;g?c.appendChild(this.addP(d,b)):c.appendChild(d.toMathML(b))}else"."==this.value?(c=document.createElement("mrow"),a.type!=e.OPERATOR||"+"!=a.value&&"-"!=a.value?c.appendChild(a.toMathML(b)):c.appendChild(this.addP(a,b)),c.appendChild(this.mo("\u22c5")),d.type!=e.OPERATOR||"+"!=d.value&&"-"!=d.value?c.appendChild(d.toMathML(b)):c.appendChild(this.addP(d,b))):"`"==this.value?(c=document.createElement("mrow"),a.type!=e.OPERATOR||"+"!=a.value&&"-"!=a.value?c.appendChild(a.toMathML(b)):c.appendChild(this.addP(a,
b)),g=document.createElement("mstyle"),g.setAttribute("fontstyle","normal"),d.type!=e.OPERATOR||"+"!=d.value&&"-"!=d.value?g.appendChild(d.toMathML(b)):g.appendChild(this.addP(d,b)),c.appendChild(g)):(c=document.createElement("mrow"),k=this.mo(this.value),c.appendChild(a.toMathML(b)),c.appendChild(k),c.appendChild(d.toMathML(b)));return c;case e.FUNCTION:if("sqrt"==a.value&&null!=d)c=document.createElement("msqrt"),c.appendChild(d.toMathML(b));else if("abs"==a.value&&null!=d)c=document.createElement("mrow"),
c.appendChild(this.mo("|")),c.appendChild(d.toMathML(b)),c.appendChild(this.mo("|"));else if("exp"==a.value&&null!=d)c=document.createElement("msup"),c.appendChild(this.mi("e")),c.appendChild(d.toMathML(b));else if("factorial"==a.value)c=document.createElement("mrow"),k=this.mo("!"),d.type!=e.OPERATOR||"+"!=d.value&&"-"!=d.value?c.appendChild(d.toMathML(b)):c.appendChild(this.addP(d,b)),c.appendChild(k);else if("diff"==a.value&&null!=this.children&&3==this.children.length)c=document.createElement("mrow"),
h=document.createElement("mfrac"),h.appendChild(this.mi("d")),k=document.createElement("mrow"),k.appendChild(this.mi("d")),k.appendChild(this.mi(g.value)),h.appendChild(k),c.appendChild(h),d.type!=e.OPERATOR||"+"!=d.value&&"-"!=d.value?c.appendChild(d.toMathML(b)):c.appendChild(this.addP(d,b));else if("diff"==a.value&&null!=this.children&&4==this.children.length)c=document.createElement("mrow"),h=document.createElement("mfrac"),a=document.createElement("msup"),a.appendChild(this.mi("d")),a.appendChild(f.toMathML(b)),
h.appendChild(a),k=document.createElement("mrow"),k.appendChild(this.mi("d")),a=document.createElement("msup"),a.appendChild(g.toMathML(b)),a.appendChild(f.toMathML(b)),k.appendChild(a),h.appendChild(k),c.appendChild(h),d.type!=e.OPERATOR||"+"!=d.value&&"-"!=d.value?c.appendChild(d.toMathML(b)):c.appendChild(this.addP(d,b));else if("integrate"==a.value&&null!=this.children&&3==this.children.length)c=document.createElement("mrow"),k=this.mo("\u222b"),k.setAttribute("stretchy","true"),c.appendChild(k),
g.type!=e.OPERATOR||"+"!=g.value&&"-"!=g.value?c.appendChild(d.toMathML(b)):c.appendChild(this.addP(d,b)),c.appendChild(this.mi("d")),c.appendChild(g.toMathML(b));else if("integrate"==a.value&&null!=this.children&&5==this.children.length)c=document.createElement("mrow"),a=document.createElement("msubsup"),k=this.mo("\u222b"),k.setAttribute("stretchy","true"),a.appendChild(k),a.appendChild(f.toMathML(b)),a.appendChild(h.toMathML(b)),c.appendChild(a),g.type!=e.OPERATOR||"+"!=g.value&&"-"!=g.value?c.appendChild(d.toMathML(b)):
c.appendChild(this.addP(d,b)),c.appendChild(this.mi("d")),c.appendChild(g.toMathML(b));else if("sum"==a.value&&null!=this.children&&5==this.children.length){c=document.createElement("mrow");var m=document.createElement("munderover");k=this.mo("\u2211");k.setAttribute("stretchy","true");m.appendChild(k);a=document.createElement("mrow");a.appendChild(g.toMathML(b));a.appendChild(this.mo("="));a.appendChild(f.toMathML(b));m.appendChild(a);m.appendChild(h.toMathML(b));c.appendChild(m);g.type!=e.OPERATOR||
"+"!=g.value&&"-"!=g.value?c.appendChild(d.toMathML(b)):c.appendChild(this.addP(d,b))}else if("product"==a.value&&null!=this.children&&5==this.children.length)c=document.createElement("mrow"),m=document.createElement("munderover"),k=this.mo("\u220f"),k.setAttribute("stretchy","true"),m.appendChild(k),a=document.createElement("mrow"),a.appendChild(g.toMathML(b)),a.appendChild(this.mo("=")),a.appendChild(f.toMathML(b)),m.appendChild(a),m.appendChild(h.toMathML(b)),c.appendChild(m),g.type!=e.OPERATOR||
"+"!=g.value&&"-"!=g.value?c.appendChild(d.toMathML(b)):c.appendChild(this.addP(d,b));else if("limit"==a.value)c=document.createElement("mrow"),4>this.children.length?c.appendChild(this.mo("lim")):(a=document.createElement("munder"),a.appendChild(this.mo("lim")),k=document.createElement("mrow"),k.appendChild(g.toMathML(b)),k.appendChild(this.mo("\u2192")),k.appendChild(f.toMathML(b)),null!=h&&("plus"==h.value?k.appendChild(this.mo("+")):"minus"==h.value&&k.appendChild(this.mo("-"))),a.appendChild(k),
c.appendChild(a)),c.appendChild(d.toMathML(b));else if("binomial"==a.value){c=document.createElement("mrow");c.appendChild(this.mo("("));g=document.createElement("mtable");for(f=1;f<this.children.length;f++)a=document.createElement("mtr"),a.appendChild(this.children[f].toMathML(b)),g.appendChild(a);c.appendChild(g);c.appendChild(this.mo(")"))}else if("matrix"==a.value){for(f=1;f<this.children.length;f++)if(this.children[f].type!==e.VECTOR)return c=document.createElement("mtext"),c.appendChild(document.createTextNode("???")),
c;c=document.createElement("mrow");c.appendChild(this.mo("("));g=document.createElement("mtable");for(f=1;f<this.children.length;f++){a=document.createElement("mtr");for(d=0;d<this.children[f].children.length;d++)a.appendChild(this.children[f].children[d].toMathML(b));g.appendChild(a)}c.appendChild(g);c.appendChild(this.mo(")"))}else if("union"==a.value&&3==this.children.length){for(f=1;f<this.children.length;f++)if(this.children[f].type!==e.INTERVAL&&this.children[f].type!==e.SET)return c=document.createElement("mtext"),
c.appendChild(document.createTextNode("???")),c;c=document.createElement("mrow");c.appendChild(d.toMathML(b));c.appendChild(this.mo("\u222a"));c.appendChild(g.toMathML(b))}else if("intersection"==a.value&&3==this.children.length){for(f=1;f<this.children.length;f++)if(this.children[f].type!==e.INTERVAL&&this.children[f].type!==e.SET)return c=document.createElement("mtext"),c.appendChild(document.createTextNode("???")),c;c=document.createElement("mrow");c.appendChild(d.toMathML(b));c.appendChild(this.mo("\u2229"));
c.appendChild(g.toMathML(b))}else{c=document.createElement("mrow");c.appendChild(a.toMathML(b));c.appendChild(this.mo("("));for(f=1;f<this.children.length;f++)c.appendChild(this.children[f].toMathML(b)),f<this.children.length-1&&c.appendChild(this.mo(l.ARG_SEPARATOR));c.appendChild(this.mo(")"))}return c;case e.VECTOR:h=!0;for(f=0;f<this.children.length;f++)this.children[f].type!==e.VECTOR&&(h=!1);c=document.createElement("mrow");c.appendChild(this.mo("("));g=document.createElement("mtable");for(f=
0;f<this.children.length;f++){a=document.createElement("mtr");if(h)for(d=0;d<this.children[f].children.length;d++)a.appendChild(this.children[f].children[d].toMathML(b));else a.appendChild(this.children[f].toMathML(b));g.appendChild(a)}c.appendChild(g);c.appendChild(this.mo(")"));return c;case e.INTERVAL:return c=document.createElement("mrow"),k=this.interval_type==e.OPEN_OPEN||this.interval_type==e.OPEN_CLOSED?this.mo("("):this.mo("["),c.appendChild(k),a=document.createElement("mrow"),a.appendChild(this.children[0].toMathML(b)),
a.appendChild(this.mo(":")),a.appendChild(this.children[1].toMathML(b)),c.appendChild(a),k=this.interval_type==e.OPEN_OPEN||this.interval_type==e.CLOSED_OPEN?this.mo(")"):this.mo("]"),c.appendChild(k),c;case e.SET:c=document.createElement("mrow");c.appendChild(this.mo("{"));a=document.createElement("mrow");for(f=0;f<this.children.length;f++)0<f&&a.appendChild(this.mo(";")),a.appendChild(this.children[f].toMathML(b));c.appendChild(a);c.appendChild(this.mo("}"));return c;case e.SUBSCRIPT:g=document.createElement("msub");
g.appendChild(a.toMathML(b));if(2<this.children.length){c=document.createElement("mrow");for(f=1;f<this.children.length;f++)c.appendChild(this.children[f].toMathML(b)),f<this.children.length-1&&c.appendChild(this.mo(l.ARG_SEPARATOR));g.appendChild(c)}else g.appendChild(d.toMathML(b));return g}};e.prototype.mi=function(b){var a=document.createElement("mi");e.symbols[b]&&(b=e.symbols[b]);a.appendChild(document.createTextNode(b));return a};e.prototype.mn=function(b){var a=document.createElement("mn");
a.appendChild(document.createTextNode(b));return a};e.prototype.mo=function(b){var a=document.createElement("mo");e.symbols[b]&&(b=e.symbols[b]);a.appendChild(document.createTextNode(b));return a};e.prototype.addP=function(b,a){var d,g;d=document.createElement("mrow");g=this.mo("(");g.setAttribute("mathcolor",e.COLORS[a.depth%e.COLORS.length]);d.appendChild(g);a.depth++;d.appendChild(b.toMathML(a));a.depth--;g=this.mo(")");g.setAttribute("mathcolor",e.COLORS[a.depth%e.COLORS.length]);d.appendChild(g);
return d};e.symbols={alpha:"\u03b1",beta:"\u03b2",gamma:"\u03b3",delta:"\u03b4",epsilon:"\u03b5",zeta:"\u03b6",eta:"\u03b7",theta:"\u03b8",iota:"\u03b9",kappa:"\u03ba",lambda:"\u03bb",mu:"\u03bc",nu:"\u03bd",xi:"\u03be",omicron:"\u03bf",pi:"\u03c0",rho:"\u03c1",sigma:"\u03c3",tau:"\u03c4",upsilon:"\u03c5",phi:"\u03c6",chi:"\u03c7",psi:"\u03c8",omega:"\u03c9",Alpha:"\u0391",Beta:"\u0392",Gamma:"\u0393",Delta:"\u0394",Epsilon:"\u0395",Zeta:"\u0396",Eta:"\u0397",Theta:"\u0398",Iota:"\u0399",Kappa:"\u039a",
Lambda:"\u039b",Mu:"\u039c",Nu:"\u039d",Xi:"\u039e",Omicron:"\u039f",Pi:"\u03a0",Rho:"\u03a1",Sigma:"\u03a3",Tau:"\u03a4",Upsilon:"\u03a5",Phi:"\u03a6",Chi:"\u03a7",Psi:"\u03a8",Omega:"\u03a9","#":"\u2260",">=":"\u2265","<=":"\u2264",inf:"\u221e",minf:"-\u221e",hbar:"\u210f",G:"\ud835\udca2"};"use strict";p.UNKNOWN=0;p.UNARY=1;p.BINARY=2;p.TERNARY=3;"use strict";n.prototype.toString=function(){return this.msg+" at "+this.from+" - "+this.to};"use strict";r.prototype.expression=function(b){var a,d=
this.current_token;if(null==d)throw new n("Expected something at the end",this.tokens[this.tokens.length-1].to+1);this.advance();if(null==d.op)a=new e(d.type,null,d.value,null);else{if(null==d.op.nud)throw new n("Unexpected operator '"+d.op.id+"'",d.from);a=d.op.nud(this)}for(;null!=this.current_token&&null!=this.current_token.op&&b<this.current_token.op.lbp;)d=this.current_token,this.advance(),a=d.op.led(this,a);return a};r.prototype.advance=function(b){if(b&&(null==this.current_token||null==this.current_token.op||
this.current_token.op.id!==b)){if(null==this.current_token)throw new n("Expected '"+b+"' at the end",this.tokens[this.tokens.length-1].to+1);throw new n("Expected '"+b+"'",this.current_token.from);}this.token_nr>=this.tokens.length?this.current_token=null:(this.current_token=this.tokens[this.token_nr],this.token_nr+=1)};r.prototype.addHiddenOperators=function(){for(var b=this.defs.findOperator("*"),a=this.defs.findOperator("`"),d=!1,g=!1,f=0;f<this.tokens.length-1;f++){var e=this.tokens[f],c=this.tokens[f+
1];this.unit_mode&&("`"==e.value?d=!0:d&&("^"==e.value?g=!0:g&&e.type==m.NUMBER?g=!1:g||e.type!=m.NUMBER?e.type==m.OPERATOR&&-1=="*/^()".indexOf(e.value)?d=!1:e.type==m.NAME&&"("==c.value&&(d=!1):d=!1));if(e.type==m.NAME&&c.type==m.NAME||e.type==m.NUMBER&&c.type==m.NAME||e.type==m.NUMBER&&c.type==m.NUMBER||e.type==m.NUMBER&&("("==c.value||"["==c.value||"{"==c.value)||(")"==e.value||"]"==e.value||"}"==e.value)&&c.type==m.NAME||(")"==e.value||"]"==e.value||"}"==e.value)&&c.type==m.NUMBER||(")"==e.value||
"]"==e.value||"}"==e.value)&&"("==c.value){if(e=this.unit_mode&&!d&&(e.type==m.NUMBER||")"==e.value||"]"==e.value||"}"==e.value)&&(c.type==m.NAME||("("==c.value||"["==c.value||"{"==c.value)&&this.tokens.length>f+2&&this.tokens[f+2].type==m.NAME)){var k,l;c.type==m.NAME?(k=c,l=f+1):(l=f+2,k=this.tokens[l]);for(var q=0;q<this.constants.length;q++)if(k.value==this.constants[q]){e=!1;break}if(this.tokens.length>l+1&&"("==this.tokens[l+1].value)for(l="pow sqrt abs exp factorial diff integrate sum product limit binomial matrix ln log log10 mod signum ceiling floor sin cos tan asin acos atan atan2 sinh cosh tanh asinh acosh atanh".split(" "),
q=0;q<l.length;q++)if(k.value==l[q]){e=!1;break}}e?(c=new m(m.OPERATOR,c.from,c.from,a.id,a),d=!0):c=new m(m.OPERATOR,c.from,c.from,b.id,b);this.tokens.splice(f+1,0,c)}}};r.prototype.parse=function(b){this.tokens=(new s(this.defs,b)).tokenize();if(0==this.tokens.length)return null;this.implicit_operators&&this.addHiddenOperators();this.token_nr=0;this.current_token=this.tokens[this.token_nr];this.advance();b=this.expression(0);if(null!=this.current_token)throw new n("Expected the end",this.current_token.from);
return b};"use strict";s.prototype.tokenize=function(){var b,a,d,g,e;a=0;b=this.text.charAt(a);e=[];a:for(;b;)if(g=a," ">=b)a++,b=this.text.charAt(a);else{if("0"<=b&&"9">=b||(b===l.DECIMAL_SIGN_1||b===l.DECIMAL_SIGN_2)&&"0"<=this.text.charAt(a+1)&&"9">=this.text.charAt(a+1)){d="";if(b!==l.DECIMAL_SIGN_1&&b!==l.DECIMAL_SIGN_2)for(a++,d+=b;;){b=this.text.charAt(a);if("0">b||"9"<b)break;a++;d+=b}if(b===l.DECIMAL_SIGN_1||b===l.DECIMAL_SIGN_2)for(a++,d+=b;;){b=this.text.charAt(a);if("0">b||"9"<b)break;
a+=1;d+=b}if("e"===b||"E"===b){a++;d+=b;b=this.text.charAt(a);if("-"===b||"+"===b)a++,d+=b,b=this.text.charAt(a);if("0">b||"9"<b)throw new n("syntax error in number exponent",g,a);do a++,d+=b,b=this.text.charAt(a);while("0"<=b&&"9">=b)}var h=+d.replace(l.DECIMAL_SIGN_1,".").replace(l.DECIMAL_SIGN_2,".");if(isFinite(h)){e.push(new m(m.NUMBER,g,a-1,d,null));continue}else throw new n("syntax error in number",g,a);}for(d=0;d<this.defs.operators.length;d++)if(h=this.defs.operators[d],this.text.substring(a,
a+h.id.length)===h.id){a+=h.id.length;b=this.text.charAt(a);e.push(new m(m.OPERATOR,g,a-1,h.id,h));continue a}if("a"<=b&&"z">=b||"A"<=b&&"Z">=b){d=b;for(a++;;)if(b=this.text.charAt(a),"a"<=b&&"z">=b||"A"<=b&&"Z">=b||"0"<=b&&"9">=b||"_"===b)d+=b,a++;else break;e.push(new m(m.NAME,g,a-1,d,null))}else throw new n("unrecognized operator",g,a);}return e};"use strict";m.UNKNOWN=0;m.NAME=1;m.NUMBER=2;m.OPERATOR=3;"use strict";var u=function(b){var a,d,e,f,h;a=b.ta;d=b.output_node;a=a.value;f="";for(h=a;h!=
f;)f=h,h=f.replace(/\[[^\[\]]*\]/g,"");if(h.split("[").length==h.split("]").length){for(f="";h!=f;)f=h,h=f.replace(/\([^\(\)]*\)/g,"");if(h.split("(").length==h.split(")").length){for(f="";h!=f;)f=h,h=f.replace(/\{[^\{\}]*\}/g,"");h.split("{").length==h.split("}").length&&-1!=h.indexOf(l.ARG_SEPARATOR)&&(a="["+a+"]")}}if(a!=b.oldtxt){for(b.oldtxt=a;null!=d.firstChild;)d.removeChild(d.firstChild);d.removeAttribute("title");if(""!=a){b=b.parser;try{if(e=b.parse(a),null!=e){var c=document.createElement("math");
c.setAttribute("display","block");c.appendChild(e.toMathML());d.appendChild(c);MathJax.Hub.Queue(["Typeset",MathJax.Hub,d])}}catch(k){e="error: "+k,d.setAttribute("title",e),k instanceof n?(d.appendChild(document.createTextNode(a.substring(0,k.from))),e=document.createElement("span"),e.appendChild(document.createTextNode(a.substring(k.from,k.to+1))),e.className="math-error",d.appendChild(e),k.to<a.length-1&&d.appendChild(document.createTextNode(a.substring(k.to+1)))):(a=document.createTextNode(e),
d.appendChild(a))}}}},t=!1;return{Definitions:l,ENode:e,Operator:p,ParseException:n,Parser:r,initEditors:function(){if(!t){t=!0;MathJax.Hub.Config({messageStyle:"none"});for(var b=[],a=document.getElementsByClassName("math"),d=0;d<a.length;d++){var e=a[d];if("TEXTAREA"==e.nodeName||"INPUT"==e.nodeName){var f=document.createElement("span");f.style.display="none";f.style.position="absolute";f.style.backgroundColor="rgba(255,255,224,0.9)";f.style.border="1px solid #A0A0A0";f.style.padding="5px";var h=
function(a,b){var c=a.getBoundingClientRect(),d=document.documentElement,e=(window.pageYOffset||d.scrollTop)-(d.clientTop||0);b.style.left=(window.pageXOffset||d.scrollLeft)-(d.clientLeft||0)+c.left+"px";b.style.top=window.innerHeight>c.bottom+b.offsetHeight?e+c.bottom+"px":e+c.top-b.offsetHeight+"px"};e.nextSibling?e.parentNode.insertBefore(f,e.nextSibling):e.parentNode.appendChild(f);e.addEventListener("blur",function(a){return function(b){a.style.display="none"}}(f),!1);e.addEventListener("focus",
function(a,b){return function(c){""!=a.value&&(b.style.display="block");h(a,b)}}(e,f),!1);var c="true"===e.getAttribute("data-implicit_operators"),k="true"===e.getAttribute("data-unit_mode"),l=e.getAttribute("data-constants");l&&(l=l.split(/[\s,]+/));b[d]={ta:e,output_node:f,oldtxt:"",parser:new r(c,k,l)};f=function(a){return function(c){var d=b[a];u(d);document.activeElement==d.ta&&(d.output_node.style.display=""!=d.ta.value?"block":"none",MathJax.Hub.Queue(function(){h(d.ta,d.output_node)}))}}(d);
""!=e.value&&f();e.addEventListener("change",f,!1);e.addEventListener("keyup",f,!1)}}}}}}();
