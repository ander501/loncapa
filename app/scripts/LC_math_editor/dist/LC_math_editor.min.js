'use strict';var LCMATH=function(){function m(){this.operators=[]}function e(b,a,d,f,g){this.type=b;this.op=a;this.value=d;this.children=f;this.interval_type="undefined"==typeof g?e.NOT_AN_INTERVAL:g}function p(b,a,d,f,g,e){this.id=b;this.arity=a;this.lbp=d;this.rbp=f;this.nud=g;this.led=e}function n(b,a,d){this.msg=b;this.from=a;this.to=d?d:this.from}function r(b,a,d){this.implicit_operators="undefined"==typeof b?!1:b;this.unit_mode="undefined"==typeof a?!1:a;this.constants="undefined"==typeof d?
[]:d;this.defs=new m;this.defs.define();this.operators=this.defs.operators;this.oph={};for(b=0;b<this.operators.length;b++)this.oph[this.operators[b].id]=this.operators[b]}function s(b,a){this.defs=b;this.text=a}function l(b,a,d,f,g){this.type=b;this.from=a;this.to=d;this.value=f;this.op=g}m.ARG_SEPARATOR=";";m.DECIMAL_SIGN_1=".";m.DECIMAL_SIGN_2=",";m.INTERVAL_SEPARATOR=":";m.prototype.operator=function(b,a,d,f,g,e){this.operators.push(new p(b,a,d,f,g,e))};m.prototype.separator=function(b){this.operator(b,
p.BINARY,0,0,null,null)};m.prototype.infix=function(b,a,d,f){var g;g=p.BINARY;f=f||function(a,c){var f=[c,a.expression(d)];return new e(e.OPERATOR,this,b,f)};this.operator(b,g,a,d,null,f)};m.prototype.prefix=function(b,a,d){var f;f=p.UNARY;d=d||function(d){d=[d.expression(a)];return new e(e.OPERATOR,this,b,d)};this.operator(b,f,0,a,d,null)};m.prototype.suffix=function(b,a,d){var f;f=p.UNARY;d=d||function(a,d){return new e(e.OPERATOR,this,b,[d])};this.operator(b,f,a,0,null,d)};m.prototype.findOperator=
function(b){for(var a=0;a<this.operators.length;a++)if(this.operators[a].id==b)return this.operators[a];return null};m.prototype.buildInterval=function(b,a,d,f){f.advance(m.INTERVAL_SEPARATOR);var g=f.expression(0);if(null==f.current_token||null==f.current_token.op||")"!==f.current_token.op.id&&"]"!==f.current_token.op.id)throw new n("Wrong interval syntax.",f.tokens[f.token_nr-1].from);")"==f.current_token.op.id?(f.advance(")"),b=b?e.CLOSED_OPEN:e.OPEN_OPEN):(f.advance("]"),b=b?e.CLOSED_CLOSED:e.OPEN_CLOSED);
return new e(e.INTERVAL,d,null,[a,g],b)};m.prototype.define=function(){this.suffix("!",160);this.infix("^",140,139);this.infix(".",130,129);this.infix("`",125,125,function(a,b){for(var f=a.expression(125);null!=a.current_token&&-1!="*/".indexOf(a.current_token.value);){var g=a.tokens[a.token_nr];if(null==g)break;if(g.type!=l.NAME&&"("!=g.value)break;g=a.tokens[a.token_nr+1];if(null!=g&&("("==g.value||g.type==l.NUMBER))break;if(a.unit_mode&&a.tokens[a.token_nr].type==l.NAME){for(var g=a.tokens[a.token_nr].value,
h=!1,c=0;c<a.constants.length;c++)if(g==a.constants[c]){h=!0;break}if(h)break}g=a.current_token;a.advance();f=g.op.led(a,f)}return new e(e.OPERATOR,this,"`",[b,f])});this.infix("*",120,120);this.infix("/",120,120);this.infix("%",120,120);this.infix("+",100,100);this.operator("-",p.BINARY,100,134,function(a){a=[a.expression(134)];return new e(e.OPERATOR,this,"-",a)},function(a,b){var f=[b,a.expression(100)];return new e(e.OPERATOR,this,"-",f)});this.infix("=",80,80);this.infix("#",80,80);this.infix("<=",
80,80);this.infix(">=",80,80);this.infix("<",80,80);this.infix(">",80,80);this.separator(")");this.separator(m.ARG_SEPARATOR);this.separator(m.INTERVAL_SEPARATOR);var b=this;this.operator("(",p.BINARY,200,200,function(a){var d=a.expression(0);if(null!=a.current_token&&null!=a.current_token.op&&a.current_token.op.id==m.INTERVAL_SEPARATOR)return b.buildInterval(!1,d,this,a);a.advance(")");return d},function(a,b){if(b.type!=e.NAME&&b.type!=e.SUBSCRIPT)throw new n("Function name expected before a parenthesis.",
a.tokens[a.token_nr-1].from);var f=[b];if(null==a.current_token||null==a.current_token.op||")"!==a.current_token.op.id)for(;;){f.push(a.expression(0));if(null==a.current_token||null==a.current_token.op||a.current_token.op.id!==m.ARG_SEPARATOR)break;a.advance(m.ARG_SEPARATOR)}a.advance(")");return new e(e.FUNCTION,this,"(",f)});this.separator("]");this.operator("[",p.BINARY,200,70,function(a){var d=[];if(null==a.current_token||null==a.current_token.op||"]"!==a.current_token.op.id){var f=a.expression(0);
if(null!=a.current_token&&null!=a.current_token.op&&a.current_token.op.id==m.INTERVAL_SEPARATOR)return b.buildInterval(!0,f,this,a);for(;;){d.push(f);if(null==a.current_token||null==a.current_token.op||a.current_token.op.id!==m.ARG_SEPARATOR)break;a.advance(m.ARG_SEPARATOR);f=a.expression(0)}}a.advance("]");return new e(e.VECTOR,this,null,d)},function(a,b){if(b.type!=e.NAME&&b.type!=e.SUBSCRIPT)throw new n("Name expected before a square bracket.",a.tokens[a.token_nr-1].from);var f=[b];if(null==a.current_token||
null==a.current_token.op||"]"!==a.current_token.op.id)for(;;){f.push(a.expression(0));if(null==a.current_token||null==a.current_token.op||a.current_token.op.id!==m.ARG_SEPARATOR)break;a.advance(m.ARG_SEPARATOR)}a.advance("]");return new e(e.SUBSCRIPT,this,"[",f)});this.separator("}");this.prefix("{",200,function(a){var b=[];if(null==a.current_token||null==a.current_token.op||"}"!==a.current_token.op.id)for(;;){b.push(a.expression(0));if(null==a.current_token||null==a.current_token.op||a.current_token.op.id!==
m.ARG_SEPARATOR)break;a.advance(m.ARG_SEPARATOR)}a.advance("}");return new e(e.SET,this,null,b)})};"use strict";e.UNKNOWN=0;e.NAME=1;e.NUMBER=2;e.OPERATOR=3;e.FUNCTION=4;e.VECTOR=5;e.INTERVAL=6;e.SET=7;e.SUBSCRIPT=8;e.COLORS="#E01010 #0010FF #009000 #FF00FF #00B0B0 #F09000 #800080 #F080A0 #6090F0 #902000 #70A050 #A07060 #5000FF #E06050 #008080 #808000".split(" ");e.NOT_AN_INTERVAL=0;e.OPEN_OPEN=1;e.OPEN_CLOSED=2;e.CLOSED_OPEN=3;e.CLOSED_CLOSED=4;e.prototype.toString=function(){var b="(";switch(this.type){case e.UNKNOWN:b+=
"UNKNOWN";break;case e.NAME:b+="NAME";break;case e.NUMBER:b+="NUMBER";break;case e.OPERATOR:b+="OPERATOR";break;case e.FUNCTION:b+="FUNCTION";break;case e.VECTOR:b+="VECTOR";break;case e.INTERVAL:b+="INTERVAL";break;case e.SET:b+="SET";break;case e.SUBSCRIPT:b+="SUBSCRIPT"}this.op&&(b+=" '"+this.op.id+"'");this.value&&(b+=" '"+this.value+"'");if(this.children){for(var b=b+" [",a=0;a<this.children.length;a++)b+=this.children[a].toString(),a!=this.children.length-1&&(b+=",");b+="]"}this.interval_type&&
(b+=" "+this.interval_type);return b+")"};e.prototype.getColorForIdentifier=function(b,a){var d=a[b];d||(d=e.COLORS[Object.keys(a).length%e.COLORS.length],a[b]=d);return d};e.prototype.toMathML=function(b){var a,d,f,g,h,c,k;"undefined"==typeof b&&(b={hcolors:{},depth:0});a=null!=this.children&&0<this.children.length?this.children[0]:null;d=null!=this.children&&1<this.children.length?this.children[1]:null;f=null!=this.children&&2<this.children.length?this.children[2]:null;g=null!=this.children&&3<
this.children.length?this.children[3]:null;h=null!=this.children&&4<this.children.length?this.children[4]:null;switch(this.type){case e.UNKNOWN:return c=document.createElement("mtext"),c.appendChild(document.createTextNode("???")),c;case e.NAME:return 0<=this.value.search(/^[a-zA-Z]+[0-9]+$/)?(c=this.value.search(/[0-9]/),f=document.createElement("msub"),f.appendChild(this.mi(this.value.substring(0,c))),f.appendChild(this.mn(this.value.substring(c))),c=f):c=this.mi(this.value),c.setAttribute("mathcolor",
this.getColorForIdentifier(this.value,b.hcolors)),c;case e.NUMBER:return-1!=this.value.indexOf("e")||-1!=this.value.indexOf("E")?(b=this.value.indexOf("e"),-1==b&&(b=this.value.indexOf("E")),c=document.createElement("mrow"),c.appendChild(this.mn(this.value.substring(0,b))),c.appendChild(this.mo("\u22c5")),a=document.createElement("msup"),a.appendChild(this.mn(10)),a.appendChild(this.mn(this.value.substring(b+1))),c.appendChild(a),c):this.mn(this.value);case e.OPERATOR:if("/"==this.value)h=document.createElement("mfrac"),
h.appendChild(a.toMathML(b)),h.appendChild(d.toMathML(b)),c=h;else if("^"==this.value)f=a.type==e.FUNCTION?"sqrt"==a.value||"abs"==a.value||"matrix"==a.value||"diff"==a.value?!1:!0:a.type==e.OPERATOR?!0:!1,c=document.createElement("msup"),f?c.appendChild(this.addP(a,b)):c.appendChild(a.toMathML(b)),c.appendChild(d.toMathML(b));else if("*"==this.value){c=document.createElement("mrow");a.type!=e.OPERATOR||"+"!=a.value&&"-"!=a.value?c.appendChild(a.toMathML(b)):c.appendChild(this.addP(a,b));for(f=d;f.type==
e.OPERATOR;)f=f.children[0];a.type==e.VECTOR&&d.type==e.VECTOR?c.appendChild(this.mo("*")):f.type==e.NUMBER&&c.appendChild(this.mo("\u22c5"));d.type!=e.OPERATOR||"+"!=d.value&&"-"!=d.value?c.appendChild(d.toMathML(b)):c.appendChild(this.addP(d,b))}else if("-"==this.value)c=document.createElement("mrow"),1==this.children.length?(c.appendChild(this.mo("-")),c.appendChild(a.toMathML(b))):(c.appendChild(a.toMathML(b)),c.appendChild(this.mo("-")),d.type!=e.OPERATOR||"+"!=d.value&&"-"!=d.value?c.appendChild(d.toMathML(b)):
c.appendChild(this.addP(d,b)));else if("!"==this.value)c=document.createElement("mrow"),k=this.mo(this.value),a.type!=e.OPERATOR||"+"!=a.value&&"-"!=a.value?c.appendChild(a.toMathML(b)):c.appendChild(this.addP(a,b)),c.appendChild(k);else if("+"==this.value){c=document.createElement("mrow");k=this.mo(this.value);c.appendChild(a.toMathML(b));c.appendChild(k);f=!1;for(g=d;g.type==e.OPERATOR;)if("-"==g.value&&1==g.children.length){f=!0;break}else if("+"==g.value||"-"==g.value||"*"==g.value)g=g.children[0];
else break;f?c.appendChild(this.addP(d,b)):c.appendChild(d.toMathML(b))}else"."==this.value?(c=document.createElement("mrow"),a.type!=e.OPERATOR||"+"!=a.value&&"-"!=a.value?c.appendChild(a.toMathML(b)):c.appendChild(this.addP(a,b)),c.appendChild(this.mo("\u22c5")),d.type!=e.OPERATOR||"+"!=d.value&&"-"!=d.value?c.appendChild(d.toMathML(b)):c.appendChild(this.addP(d,b))):"`"==this.value?(c=document.createElement("mrow"),a.type!=e.OPERATOR||"+"!=a.value&&"-"!=a.value?c.appendChild(a.toMathML(b)):c.appendChild(this.addP(a,
b)),f=document.createElement("mstyle"),f.setAttribute("fontstyle","normal"),d.type!=e.OPERATOR||"+"!=d.value&&"-"!=d.value?f.appendChild(d.toMathML(b)):f.appendChild(this.addP(d,b)),c.appendChild(f)):(c=document.createElement("mrow"),k=this.mo(this.value),c.appendChild(a.toMathML(b)),c.appendChild(k),c.appendChild(d.toMathML(b)));return c;case e.FUNCTION:if("sqrt"==a.value&&null!=d)c=document.createElement("msqrt"),c.appendChild(d.toMathML(b));else if("abs"==a.value&&null!=d)c=document.createElement("mrow"),
c.appendChild(this.mo("|")),c.appendChild(d.toMathML(b)),c.appendChild(this.mo("|"));else if("exp"==a.value&&null!=d)c=document.createElement("msup"),c.appendChild(this.mi("e")),c.appendChild(d.toMathML(b));else if("factorial"==a.value)c=document.createElement("mrow"),k=this.mo("!"),d.type!=e.OPERATOR||"+"!=d.value&&"-"!=d.value?c.appendChild(d.toMathML(b)):c.appendChild(this.addP(d,b)),c.appendChild(k);else if("diff"==a.value&&null!=this.children&&3==this.children.length)c=document.createElement("mrow"),
h=document.createElement("mfrac"),h.appendChild(this.mi("d")),k=document.createElement("mrow"),k.appendChild(this.mi("d")),k.appendChild(this.mi(f.value)),h.appendChild(k),c.appendChild(h),d.type!=e.OPERATOR||"+"!=d.value&&"-"!=d.value?c.appendChild(d.toMathML(b)):c.appendChild(this.addP(d,b));else if("diff"==a.value&&null!=this.children&&4==this.children.length)c=document.createElement("mrow"),h=document.createElement("mfrac"),a=document.createElement("msup"),a.appendChild(this.mi("d")),a.appendChild(g.toMathML(b)),
h.appendChild(a),k=document.createElement("mrow"),k.appendChild(this.mi("d")),a=document.createElement("msup"),a.appendChild(f.toMathML(b)),a.appendChild(g.toMathML(b)),k.appendChild(a),h.appendChild(k),c.appendChild(h),d.type!=e.OPERATOR||"+"!=d.value&&"-"!=d.value?c.appendChild(d.toMathML(b)):c.appendChild(this.addP(d,b));else if("integrate"==a.value&&null!=this.children&&3==this.children.length)c=document.createElement("mrow"),k=this.mo("\u222b"),k.setAttribute("stretchy","true"),c.appendChild(k),
f.type!=e.OPERATOR||"+"!=f.value&&"-"!=f.value?c.appendChild(d.toMathML(b)):c.appendChild(this.addP(d,b)),c.appendChild(this.mi("d")),c.appendChild(f.toMathML(b));else if("integrate"==a.value&&null!=this.children&&5==this.children.length)c=document.createElement("mrow"),a=document.createElement("msubsup"),k=this.mo("\u222b"),k.setAttribute("stretchy","true"),a.appendChild(k),a.appendChild(g.toMathML(b)),a.appendChild(h.toMathML(b)),c.appendChild(a),f.type!=e.OPERATOR||"+"!=f.value&&"-"!=f.value?c.appendChild(d.toMathML(b)):
c.appendChild(this.addP(d,b)),c.appendChild(this.mi("d")),c.appendChild(f.toMathML(b));else if("sum"==a.value&&null!=this.children&&5==this.children.length){c=document.createElement("mrow");var l=document.createElement("munderover");k=this.mo("\u2211");k.setAttribute("stretchy","true");l.appendChild(k);a=document.createElement("mrow");a.appendChild(f.toMathML(b));a.appendChild(this.mo("="));a.appendChild(g.toMathML(b));l.appendChild(a);l.appendChild(h.toMathML(b));c.appendChild(l);f.type!=e.OPERATOR||
"+"!=f.value&&"-"!=f.value?c.appendChild(d.toMathML(b)):c.appendChild(this.addP(d,b))}else if("product"==a.value&&null!=this.children&&5==this.children.length)c=document.createElement("mrow"),l=document.createElement("munderover"),k=this.mo("\u220f"),k.setAttribute("stretchy","true"),l.appendChild(k),a=document.createElement("mrow"),a.appendChild(f.toMathML(b)),a.appendChild(this.mo("=")),a.appendChild(g.toMathML(b)),l.appendChild(a),l.appendChild(h.toMathML(b)),c.appendChild(l),f.type!=e.OPERATOR||
"+"!=f.value&&"-"!=f.value?c.appendChild(d.toMathML(b)):c.appendChild(this.addP(d,b));else if("limit"==a.value)c=document.createElement("mrow"),4>this.children.length?c.appendChild(this.mo("lim")):(a=document.createElement("munder"),a.appendChild(this.mo("lim")),k=document.createElement("mrow"),k.appendChild(f.toMathML(b)),k.appendChild(this.mo("\u2192")),k.appendChild(g.toMathML(b)),null!=h&&("plus"==h.value?k.appendChild(this.mo("+")):"minus"==h.value&&k.appendChild(this.mo("-"))),a.appendChild(k),
c.appendChild(a)),c.appendChild(d.toMathML(b));else if("binomial"==a.value){c=document.createElement("mrow");c.appendChild(this.mo("("));f=document.createElement("mtable");for(g=1;g<this.children.length;g++)a=document.createElement("mtr"),a.appendChild(this.children[g].toMathML(b)),f.appendChild(a);c.appendChild(f);c.appendChild(this.mo(")"))}else if("matrix"==a.value){for(g=1;g<this.children.length;g++)if(this.children[g].type!==e.VECTOR)return c=document.createElement("mtext"),c.appendChild(document.createTextNode("???")),
c;c=document.createElement("mrow");c.appendChild(this.mo("("));f=document.createElement("mtable");for(g=1;g<this.children.length;g++){a=document.createElement("mtr");for(d=0;d<this.children[g].children.length;d++)a.appendChild(this.children[g].children[d].toMathML(b));f.appendChild(a)}c.appendChild(f);c.appendChild(this.mo(")"))}else if("union"==a.value&&3==this.children.length){for(g=1;g<this.children.length;g++)if(this.children[g].type!==e.INTERVAL&&this.children[g].type!==e.SET)return c=document.createElement("mtext"),
c.appendChild(document.createTextNode("???")),c;c=document.createElement("mrow");c.appendChild(d.toMathML(b));c.appendChild(this.mo("\u222a"));c.appendChild(f.toMathML(b))}else if("intersection"==a.value&&3==this.children.length){for(g=1;g<this.children.length;g++)if(this.children[g].type!==e.INTERVAL&&this.children[g].type!==e.SET)return c=document.createElement("mtext"),c.appendChild(document.createTextNode("???")),c;c=document.createElement("mrow");c.appendChild(d.toMathML(b));c.appendChild(this.mo("\u2229"));
c.appendChild(f.toMathML(b))}else{c=document.createElement("mrow");c.appendChild(a.toMathML(b));c.appendChild(this.mo("("));for(g=1;g<this.children.length;g++)c.appendChild(this.children[g].toMathML(b)),g<this.children.length-1&&c.appendChild(this.mo(m.ARG_SEPARATOR));c.appendChild(this.mo(")"))}return c;case e.VECTOR:h=!0;for(g=0;g<this.children.length;g++)this.children[g].type!==e.VECTOR&&(h=!1);c=document.createElement("mrow");c.appendChild(this.mo("("));f=document.createElement("mtable");for(g=
0;g<this.children.length;g++){a=document.createElement("mtr");if(h)for(d=0;d<this.children[g].children.length;d++)a.appendChild(this.children[g].children[d].toMathML(b));else a.appendChild(this.children[g].toMathML(b));f.appendChild(a)}c.appendChild(f);c.appendChild(this.mo(")"));return c;case e.INTERVAL:return c=document.createElement("mrow"),k=this.interval_type==e.OPEN_OPEN||this.interval_type==e.OPEN_CLOSED?this.mo("("):this.mo("["),c.appendChild(k),a=document.createElement("mrow"),a.appendChild(this.children[0].toMathML(b)),
a.appendChild(this.mo(":")),a.appendChild(this.children[1].toMathML(b)),c.appendChild(a),k=this.interval_type==e.OPEN_OPEN||this.interval_type==e.CLOSED_OPEN?this.mo(")"):this.mo("]"),c.appendChild(k),c;case e.SET:c=document.createElement("mrow");c.appendChild(this.mo("{"));a=document.createElement("mrow");for(g=0;g<this.children.length;g++)0<g&&a.appendChild(this.mo(";")),a.appendChild(this.children[g].toMathML(b));c.appendChild(a);c.appendChild(this.mo("}"));return c;case e.SUBSCRIPT:f=document.createElement("msub");
f.appendChild(a.toMathML(b));if(2<this.children.length){c=document.createElement("mrow");for(g=1;g<this.children.length;g++)c.appendChild(this.children[g].toMathML(b)),g<this.children.length-1&&c.appendChild(this.mo(m.ARG_SEPARATOR));f.appendChild(c)}else f.appendChild(d.toMathML(b));return f}};e.prototype.mi=function(b){var a=document.createElement("mi");e.symbols[b]&&(b=e.symbols[b]);a.appendChild(document.createTextNode(b));return a};e.prototype.mn=function(b){var a=document.createElement("mn");
a.appendChild(document.createTextNode(b));return a};e.prototype.mo=function(b){var a=document.createElement("mo");e.symbols[b]&&(b=e.symbols[b]);a.appendChild(document.createTextNode(b));return a};e.prototype.addP=function(b,a){var d,f;d=document.createElement("mrow");f=this.mo("(");f.setAttribute("mathcolor",e.COLORS[a.depth%e.COLORS.length]);d.appendChild(f);a.depth++;d.appendChild(b.toMathML(a));a.depth--;f=this.mo(")");f.setAttribute("mathcolor",e.COLORS[a.depth%e.COLORS.length]);d.appendChild(f);
return d};e.symbols={alpha:"\u03b1",beta:"\u03b2",gamma:"\u03b3",delta:"\u03b4",epsilon:"\u03b5",zeta:"\u03b6",eta:"\u03b7",theta:"\u03b8",iota:"\u03b9",kappa:"\u03ba",lambda:"\u03bb",mu:"\u03bc",nu:"\u03bd",xi:"\u03be",omicron:"\u03bf",pi:"\u03c0",rho:"\u03c1",sigma:"\u03c3",tau:"\u03c4",upsilon:"\u03c5",phi:"\u03c6",chi:"\u03c7",psi:"\u03c8",omega:"\u03c9",Alpha:"\u0391",Beta:"\u0392",Gamma:"\u0393",Delta:"\u0394",Epsilon:"\u0395",Zeta:"\u0396",Eta:"\u0397",Theta:"\u0398",Iota:"\u0399",Kappa:"\u039a",
Lambda:"\u039b",Mu:"\u039c",Nu:"\u039d",Xi:"\u039e",Omicron:"\u039f",Pi:"\u03a0",Rho:"\u03a1",Sigma:"\u03a3",Tau:"\u03a4",Upsilon:"\u03a5",Phi:"\u03a6",Chi:"\u03a7",Psi:"\u03a8",Omega:"\u03a9","#":"\u2260",">=":"\u2265","<=":"\u2264",inf:"\u221e",minf:"-\u221e",hbar:"\u210f",G:"\ud835\udca2"};"use strict";p.UNKNOWN=0;p.UNARY=1;p.BINARY=2;p.TERNARY=3;"use strict";n.prototype.toString=function(){return this.msg+" at "+this.from+" - "+this.to};"use strict";r.prototype.expression=function(b){var a,d=
this.current_token;if(null==d)throw new n("Expected something at the end",this.tokens[this.tokens.length-1].to+1);this.advance();if(null==d.op)a=new e(d.type,null,d.value,null);else{if(null==d.op.nud)throw new n("Unexpected operator '"+d.op.id+"'",d.from);a=d.op.nud(this)}for(;null!=this.current_token&&null!=this.current_token.op&&b<this.current_token.op.lbp;)d=this.current_token,this.advance(),a=d.op.led(this,a);return a};r.prototype.advance=function(b){if(b&&(null==this.current_token||null==this.current_token.op||
this.current_token.op.id!==b)){if(null==this.current_token)throw new n("Expected '"+b+"' at the end",this.tokens[this.tokens.length-1].to+1);throw new n("Expected '"+b+"'",this.current_token.from);}this.token_nr>=this.tokens.length?this.current_token=null:(this.current_token=this.tokens[this.token_nr],this.token_nr+=1)};r.prototype.addHiddenOperators=function(){for(var b=this.defs.findOperator("*"),a=this.defs.findOperator("`"),d=!1,f=!1,e=0;e<this.tokens.length-1;e++){var h=this.tokens[e],c=this.tokens[e+
1];this.unit_mode&&("`"==h.value?d=!0:d&&("^"==h.value?f=!0:f&&h.type==l.NUMBER?f=!1:f||h.type!=l.NUMBER?h.type==l.OPERATOR&&-1=="*/^()".indexOf(h.value)?d=!1:h.type==l.NAME&&"("==c.value&&(d=!1):d=!1));if(h.type==l.NAME&&c.type==l.NAME||h.type==l.NUMBER&&c.type==l.NAME||h.type==l.NUMBER&&c.type==l.NUMBER||h.type==l.NUMBER&&("("==c.value||"["==c.value||"{"==c.value)||(")"==h.value||"]"==h.value||"}"==h.value)&&c.type==l.NAME||(")"==h.value||"]"==h.value||"}"==h.value)&&c.type==l.NUMBER||(")"==h.value||
"]"==h.value||"}"==h.value)&&"("==c.value){if(h=this.unit_mode&&!d&&(h.type==l.NUMBER||")"==h.value||"]"==h.value||"}"==h.value)&&(c.type==l.NAME||("("==c.value||"["==c.value||"{"==c.value)&&this.tokens.length>e+2&&this.tokens[e+2].type==l.NAME)){var k,m;c.type==l.NAME?(k=c,m=e+1):(m=e+2,k=this.tokens[m]);for(var q=0;q<this.constants.length;q++)if(k.value==this.constants[q]){h=!1;break}if(this.tokens.length>m+1&&"("==this.tokens[m+1].value)for(m="pow sqrt abs exp factorial diff integrate sum product limit binomial matrix ln log log10 mod signum ceiling floor sin cos tan asin acos atan atan2 sinh cosh tanh asinh acosh atanh".split(" "),
q=0;q<m.length;q++)if(k.value==m[q]){h=!1;break}}h?(c=new l(l.OPERATOR,c.from,c.from,a.id,a),d=!0):c=new l(l.OPERATOR,c.from,c.from,b.id,b);this.tokens.splice(e+1,0,c)}}};r.prototype.parse=function(b){this.tokens=(new s(this.defs,b)).tokenize();if(0==this.tokens.length)return null;this.implicit_operators&&this.addHiddenOperators();this.token_nr=0;this.current_token=this.tokens[this.token_nr];this.advance();b=this.expression(0);if(null!=this.current_token)throw new n("Expected the end",this.current_token.from);
return b};"use strict";s.prototype.tokenize=function(){var b,a,d,f,e;a=0;b=this.text.charAt(a);e=[];a:for(;b;)if(f=a," ">=b)a++,b=this.text.charAt(a);else{if("0"<=b&&"9">=b||(b===m.DECIMAL_SIGN_1||b===m.DECIMAL_SIGN_2)&&"0"<=this.text.charAt(a+1)&&"9">=this.text.charAt(a+1)){d="";if(b!==m.DECIMAL_SIGN_1&&b!==m.DECIMAL_SIGN_2)for(a++,d+=b;;){b=this.text.charAt(a);if("0">b||"9"<b)break;a++;d+=b}if(b===m.DECIMAL_SIGN_1||b===m.DECIMAL_SIGN_2)for(a++,d+=b;;){b=this.text.charAt(a);if("0">b||"9"<b)break;
a+=1;d+=b}if("e"===b||"E"===b){a++;d+=b;b=this.text.charAt(a);if("-"===b||"+"===b)a++,d+=b,b=this.text.charAt(a);if("0">b||"9"<b)throw new n("syntax error in number exponent",f,a);do a++,d+=b,b=this.text.charAt(a);while("0"<=b&&"9">=b)}var h=+d.replace(m.DECIMAL_SIGN_1,".").replace(m.DECIMAL_SIGN_2,".");if(isFinite(h)){e.push(new l(l.NUMBER,f,a-1,d,null));continue}else throw new n("syntax error in number",f,a);}for(d=0;d<this.defs.operators.length;d++)if(h=this.defs.operators[d],this.text.substring(a,
a+h.id.length)===h.id){a+=h.id.length;b=this.text.charAt(a);e.push(new l(l.OPERATOR,f,a-1,h.id,h));continue a}if("a"<=b&&"z">=b||"A"<=b&&"Z">=b){d=b;for(a++;;)if(b=this.text.charAt(a),"a"<=b&&"z">=b||"A"<=b&&"Z">=b||"0"<=b&&"9">=b||"_"===b)d+=b,a++;else break;e.push(new l(l.NAME,f,a-1,d,null))}else throw new n("unrecognized operator",f,a);}return e};"use strict";l.UNKNOWN=0;l.NAME=1;l.NUMBER=2;l.OPERATOR=3;"use strict";var t=!1;return{Definitions:m,ENode:e,Operator:p,ParseException:n,Parser:r,initEditors:function(){if(!t){t=
!0;for(var b=[],a=document.getElementsByClassName("math"),d=0;d<a.length;d++){var f=a[d];if("TEXTAREA"==f.nodeName||"INPUT"==f.nodeName){var e=document.createElement("span");e.setAttribute("style","display:none");f.nextSibling?f.parentNode.insertBefore(e,f.nextSibling):f.parentNode.appendChild(e);f.addEventListener("blur",function(a){return function(b){a.setAttribute("style","display:none")}}(e),!1);f.addEventListener("focus",function(a){return function(b){a.setAttribute("style","display: inline-block; background-color: #FFFFE0")}}(e),
!1);var h="true"===f.getAttribute("data-implicit_operators"),c="true"===f.getAttribute("data-unit_mode"),k=f.getAttribute("data-constants");k&&(k=k.split(/[\s,]+/));b[d]={ta:f,output_node:e,oldtxt:"",parser:new r(h,c,k)};e=function(a){return function(c){var d=b[a];document.activeElement==d.ta&&d.output_node.setAttribute("style","display: inline-block; background-color: #FFFFE0");var e,f,g,h;e=d.ta;c=d.output_node;e=e.value;g="";for(h=e;h!=g;)g=h,h=g.replace(/\[[^\[\]]*\]/g,"");if(h.split("[").length==
h.split("]").length){for(g="";h!=g;)g=h,h=g.replace(/\([^\(\)]*\)/g,"");if(h.split("(").length==h.split(")").length){for(g="";h!=g;)g=h,h=g.replace(/\{[^\{\}]*\}/g,"");h.split("{").length==h.split("}").length&&-1!=h.indexOf(m.ARG_SEPARATOR)&&(e="["+e+"]")}}if(e!=d.oldtxt){for(d.oldtxt=e;null!=c.firstChild;)c.removeChild(c.firstChild);c.removeAttribute("title");if(""!=e){d=d.parser;try{if(f=d.parse(e),null!=f){var k=document.createElement("math");k.setAttribute("display","block");k.appendChild(f.toMathML());
c.appendChild(k);MathJax.Hub.Queue(["Typeset",MathJax.Hub,c])}}catch(l){f="error: "+l,c.setAttribute("title",f),l instanceof n?(c.appendChild(document.createTextNode(e.substring(0,l.from))),f=document.createElement("span"),f.appendChild(document.createTextNode(e.substring(l.from,l.to+1))),f.className="math-error",c.appendChild(f),l.to<e.length-1&&c.appendChild(document.createTextNode(e.substring(l.to+1)))):(e=document.createTextNode(f),c.appendChild(e))}}}}}(d);""!=f.value&&e();f.addEventListener("change",
e,!1);f.addEventListener("keyup",e,!1)}}}}}}();
